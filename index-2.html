<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SignalMD ‚Äî Clinical Triage Platform</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}

:root{
  --bg:#f0f3f7;
  --surface:#ffffff;
  --surface-2:#f7f9fb;
  --surface-3:#eef1f6;
  --border:#dde3ec;
  --border-2:#c8d0dc;
  --navy:#0b1e35;
  --navy-2:#152d4a;
  --navy-3:#1e3d63;
  --blue:#1760b4;
  --blue-2:#2075d6;
  --blue-light:#e3edf9;
  --text:#0d1f33;
  --text-2:#3d5166;
  --text-3:#7a92a8;
  --text-4:#a8bccf;
  --critical:#c0392b;
  --critical-bg:#fef2f2;
  --critical-border:#fca5a5;
  --high:#b45309;
  --high-bg:#fffbeb;
  --high-border:#fcd34d;
  --medium:#047857;
  --medium-bg:#f0fdf4;
  --medium-border:#6ee7b7;
  --low:#1760b4;
  --low-bg:#eff6ff;
  --low-border:#93c5fd;
  --green:#16a34a;
  --amber:#d97706;
  --sidebar-w:200px;
  --header-h:52px;
}

html,body{height:100%;overflow:hidden;font-family:'IBM Plex Sans',sans-serif;background:var(--bg);color:var(--text);}

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen{display:none;height:100vh;flex-direction:column;overflow:hidden;}
.screen.active{display:flex;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{background:var(--navy);height:var(--header-h);display:flex;align-items:center;padding:0 20px;gap:0;flex-shrink:0;border-bottom:1px solid rgba(255,255,255,0.06);}
.logo{display:flex;align-items:center;gap:9px;margin-right:28px;}
.logo-box{width:28px;height:28px;background:var(--blue-2);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:700;color:white;font-family:'IBM Plex Mono',monospace;}
.logo-text{font-size:1rem;font-weight:700;color:white;letter-spacing:-0.01em;}
.topbar-divider{width:1px;height:28px;background:rgba(255,255,255,0.1);margin:0 16px;}
.ward-tabs{display:flex;gap:0;height:var(--header-h);}
.ward-tab{padding:0 16px;display:flex;align-items:center;gap:6px;font-size:0.82rem;color:rgba(255,255,255,0.45);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.15s;white-space:nowrap;}
.ward-tab:hover{color:rgba(255,255,255,0.7);}
.ward-tab.active{color:white;border-bottom-color:var(--blue-2);}
.ward-count{background:rgba(255,255,255,0.1);border-radius:10px;padding:1px 7px;font-size:0.7rem;font-weight:700;}
.ward-tab.active .ward-count{background:var(--blue-2);}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:12px;}
.live-badge{display:flex;align-items:center;gap:6px;font-size:0.72rem;color:rgba(255,255,255,0.45);font-family:'IBM Plex Mono',monospace;}
.pulse{width:7px;height:7px;border-radius:50%;background:#22c55e;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.5;transform:scale(0.8);}}
.role-badge{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.08);border-radius:20px;padding:4px 12px;font-size:0.75rem;color:rgba(255,255,255,0.7);}
.topbar-avatar{width:28px;height:28px;background:var(--blue-2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.68rem;font-weight:700;color:white;cursor:pointer;}

/* ‚îÄ‚îÄ STEPS BAR ‚îÄ‚îÄ */
.steps-bar{background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:stretch;padding:0 24px;height:56px;flex-shrink:0;gap:0;}
.step-item{display:flex;align-items:center;gap:10px;padding:0 20px;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.15s;position:relative;}
.step-item:hover{background:var(--surface-2);}
.step-item.active{border-bottom-color:var(--blue);}
.step-item.done .step-num{background:#16a34a;color:white;}
.step-num{width:24px;height:24px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:700;color:var(--text-3);flex-shrink:0;transition:all 0.2s;}
.step-item.active .step-num{background:var(--blue);color:white;}
.step-label{font-size:0.8rem;font-weight:600;color:var(--text-3);}
.step-item.active .step-label{color:var(--text);}
.step-item.done .step-label{color:var(--green);}
.step-arrow{color:var(--border-2);font-size:1rem;padding:0 4px;}

/* ‚îÄ‚îÄ STATSBAR ‚îÄ‚îÄ */
.statsbar{background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;height:60px;flex-shrink:0;gap:0;}
.stat{display:flex;align-items:center;gap:10px;padding:0 20px 0 0;margin-right:20px;border-right:1px solid var(--border);}
.stat:last-of-type{border-right:none;}
.stat-num{font-size:1.5rem;font-weight:700;font-family:'IBM Plex Mono',monospace;line-height:1;}
.stat-num.red{color:var(--critical);}
.stat-num.amber{color:var(--amber);}
.stat-num.green{color:var(--green);}
.stat-info{display:flex;flex-direction:column;}
.stat-label{font-size:0.72rem;font-weight:600;color:var(--text-2);}
.stat-sub{font-size:0.65rem;color:var(--text-3);}
.statsbar-actions{margin-left:auto;display:flex;gap:8px;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{padding:8px 18px;border-radius:7px;font-size:0.82rem;font-weight:600;cursor:pointer;border:none;font-family:'IBM Plex Sans',sans-serif;transition:all 0.15s;display:inline-flex;align-items:center;gap:6px;}
.btn-primary{background:var(--blue);color:white;}
.btn-primary:hover{background:var(--blue-2);}
.btn-ghost{background:transparent;color:var(--text-2);border:1px solid var(--border);}
.btn-ghost:hover{background:var(--surface-2);}
.btn-critical{background:var(--critical);color:white;}
.btn-critical:hover{background:#a93226;}
.btn-success{background:var(--green);color:white;}
.btn-success:hover{background:#15803d;}
.btn-sm{padding:5px 12px;font-size:0.75rem;}

/* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
.main-content{flex:1;overflow:hidden;display:flex;}
.content-area{flex:1;overflow-y:auto;padding:24px;}
.content-area::-webkit-scrollbar{width:5px;}
.content-area::-webkit-scrollbar-thumb{background:var(--border-2);border-radius:3px;}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
.card-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.card-title{font-size:0.82rem;font-weight:700;color:var(--text-3);letter-spacing:0.08em;text-transform:uppercase;}
.card-body{padding:20px;}

/* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.form-grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-group.full{grid-column:1/-1;}
.form-label{font-size:0.75rem;font-weight:600;color:var(--text-2);}
.form-input{border:1px solid var(--border);border-radius:7px;padding:9px 12px;font-size:0.85rem;font-family:'IBM Plex Sans',sans-serif;color:var(--text);background:var(--surface-2);transition:border-color 0.15s;outline:none;}
.form-input:focus{border-color:var(--blue);background:white;}
.form-select{border:1px solid var(--border);border-radius:7px;padding:9px 12px;font-size:0.85rem;font-family:'IBM Plex Sans',sans-serif;color:var(--text);background:var(--surface-2);outline:none;cursor:pointer;}
.form-select:focus{border-color:var(--blue);}
.form-textarea{border:1px solid var(--border);border-radius:7px;padding:9px 12px;font-size:0.85rem;font-family:'IBM Plex Sans',sans-serif;color:var(--text);background:var(--surface-2);resize:vertical;outline:none;min-height:80px;}
.form-textarea:focus{border-color:var(--blue);}

/* ‚îÄ‚îÄ SYMPTOM TAGS ‚îÄ‚îÄ */
.symptom-grid{display:flex;flex-wrap:wrap;gap:8px;padding:4px 0;}
.sym-tag{padding:6px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--surface);font-size:0.78rem;cursor:pointer;transition:all 0.15s;user-select:none;font-weight:500;}
.sym-tag:hover{border-color:var(--blue);color:var(--blue);}
.sym-tag.selected{background:var(--blue-light);border-color:var(--blue);color:var(--blue);font-weight:600;}

/* ‚îÄ‚îÄ VITALS SLIDERS ‚îÄ‚îÄ */
.vitals-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
.vital-card{background:var(--surface-2);border:1px solid var(--border);border-radius:10px;padding:14px;}
.vital-label{font-size:0.65rem;font-weight:700;color:var(--text-3);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:6px;}
.vital-value{font-size:1.5rem;font-weight:700;font-family:'IBM Plex Mono',monospace;margin-bottom:6px;}
.vital-value.red{color:var(--critical);}
.vital-value.amber{color:var(--amber);}
.vital-value.green{color:var(--green);}
.vital-value.normal{color:var(--text);}
.vital-unit{font-size:0.7rem;color:var(--text-3);font-family:'IBM Plex Mono',monospace;}
input[type=range]{width:100%;accent-color:var(--blue);height:4px;cursor:pointer;}

/* ‚îÄ‚îÄ SEVERITY BADGE ‚îÄ‚îÄ */
.sev-badge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:12px;font-size:0.7rem;font-weight:700;letter-spacing:0.04em;white-space:nowrap;}
.sev-critical{background:var(--critical-bg);color:var(--critical);border:1px solid var(--critical-border);}
.sev-high{background:var(--high-bg);color:var(--high);border:1px solid var(--high-border);}
.sev-medium{background:var(--medium-bg);color:var(--medium);border:1px solid var(--medium-border);}
.sev-low{background:var(--low-bg);color:var(--low);border:1px solid var(--low-border);}

/* ‚îÄ‚îÄ QUEUE TABLE ‚îÄ‚îÄ */
.toolbar{background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 20px;gap:10px;height:48px;flex-shrink:0;}
.search-wrap{position:relative;display:flex;align-items:center;}
.search-icon{position:absolute;left:10px;color:var(--text-3);font-size:1rem;}
.search-input{border:1px solid var(--border);border-radius:7px;padding:7px 12px 7px 32px;font-size:0.82rem;background:var(--surface-2);outline:none;width:240px;font-family:'IBM Plex Sans',sans-serif;}
.search-input:focus{border-color:var(--blue);}
.filter-chip{padding:5px 12px;border-radius:20px;border:1px solid var(--border);background:var(--surface);font-size:0.75rem;font-weight:600;cursor:pointer;transition:all 0.15s;color:var(--text-2);}
.filter-chip.active-all{background:var(--navy);color:white;border-color:var(--navy);}
.filter-chip.active-critical{background:var(--critical-bg);color:var(--critical);border-color:var(--critical-border);}
.filter-chip.active-high{background:var(--high-bg);color:var(--high);border-color:var(--high-border);}
.filter-chip.active-medium{background:var(--medium-bg);color:var(--medium);border-color:var(--medium-border);}
.filter-chip.active-low{background:var(--low-bg);color:var(--low);border-color:var(--low-border);}
.result-count{margin-left:auto;font-size:0.75rem;color:var(--text-3);font-family:'IBM Plex Mono',monospace;}

.table-wrap{flex:1;overflow-y:auto;position:relative;}
.table-wrap::-webkit-scrollbar{width:5px;}
.table-wrap::-webkit-scrollbar-thumb{background:var(--border-2);border-radius:3px;}

table{width:100%;border-collapse:collapse;}
thead tr{background:var(--surface-2);position:sticky;top:0;z-index:2;}
th{padding:10px 14px;font-size:0.68rem;font-weight:700;color:var(--text-3);letter-spacing:0.1em;text-transform:uppercase;text-align:left;border-bottom:1px solid var(--border);white-space:nowrap;cursor:pointer;}
th:hover{color:var(--text-2);}
tbody tr{border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.1s;}
tbody tr:hover{background:var(--blue-light);}
tbody tr.selected{background:var(--blue-light);}
tbody tr.critical-row{border-left:3px solid var(--critical);}
tbody tr.high-row{border-left:3px solid var(--high);}
tbody tr.medium-row{border-left:3px solid var(--medium);}
tbody tr.low-row{border-left:3px solid var(--low-border);}
td{padding:10px 14px;font-size:0.8rem;color:var(--text);white-space:nowrap;vertical-align:middle;}
.patient-name{font-weight:700;font-size:0.85rem;margin-bottom:2px;}
.patient-meta{font-size:0.7rem;color:var(--text-3);font-family:'IBM Plex Mono',monospace;}
.score-row{display:flex;align-items:center;gap:8px;}
.score-bar{flex:1;height:5px;background:var(--border);border-radius:3px;overflow:hidden;min-width:60px;}
.score-fill{height:100%;border-radius:3px;}
.fill-critical{background:var(--critical);}
.fill-high{background:var(--high);}
.fill-medium{background:var(--medium);}
.fill-low{background:var(--low);}
.score-num{font-family:'IBM Plex Mono',monospace;font-size:0.78rem;font-weight:600;min-width:24px;text-align:right;}
.vital-compact{font-family:'IBM Plex Mono',monospace;font-size:0.7rem;}
.vital-compact .val-red{color:var(--critical);}
.vital-compact .val-amber{color:var(--amber);}
.vital-compact .val-green{color:var(--green);}
.wait-urgent{color:var(--critical);font-weight:700;}
.wait-warn{color:var(--amber);font-weight:600;}
.tbl-btn{padding:5px 12px;border-radius:5px;font-size:0.72rem;font-weight:600;cursor:pointer;border:none;font-family:'IBM Plex Sans',sans-serif;transition:all 0.15s;}
.tbl-btn-primary{background:var(--blue);color:white;}
.tbl-btn-primary:hover{background:var(--blue-2);}
.tbl-btn-ghost{background:var(--surface);color:var(--text-2);border:1px solid var(--border);}
tbody tr:nth-child(even):not(:hover):not(.selected){background:rgba(240,244,248,0.5);}

/* ‚îÄ‚îÄ DETAIL PANEL ‚îÄ‚îÄ */
.detail-panel{width:320px;flex-shrink:0;background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transition:width 0.3s;}
.detail-panel.hidden{width:0;border:none;}
.panel-header{padding:16px;border-bottom:1px solid var(--border);flex-shrink:0;background:var(--navy);}
.panel-name{font-size:1.1rem;font-weight:700;color:white;margin-bottom:2px;}
.panel-meta{font-size:0.75rem;color:rgba(255,255,255,0.55);margin-bottom:8px;}
.panel-body{flex:1;overflow-y:auto;padding:0;}
.panel-body::-webkit-scrollbar{width:3px;}
.panel-body::-webkit-scrollbar-thumb{background:var(--border-2);}
.panel-section{padding:14px 16px;border-bottom:1px solid var(--border);}
.panel-section-title{font-size:0.62rem;font-weight:700;color:var(--text-3);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:10px;}
.vitals-grid-panel{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.vital-panel-item{background:var(--surface-2);border-radius:7px;padding:10px;}
.vital-panel-label{font-size:0.6rem;color:var(--text-3);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:3px;}
.vital-panel-val{font-size:1.1rem;font-weight:700;font-family:'IBM Plex Mono',monospace;}
.diag-tier{border-left:3px solid var(--border);padding:8px 10px;margin-bottom:8px;background:var(--surface-2);border-radius:0 7px 7px 0;}
.diag-tier.t1{border-left-color:var(--blue);}
.diag-tier.t2{border-left-color:var(--high);}
.diag-tier.t3{border-left-color:var(--border-2);}
.tier-label{font-size:0.58rem;font-weight:700;color:var(--text-3);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:2px;}
.tier-name{font-size:0.82rem;font-weight:700;color:var(--text);}
.tier-conf{font-size:0.7rem;color:var(--text-3);margin-bottom:5px;}
.conf-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden;}
.conf-fill{height:100%;border-radius:2px;}
.alert-panel{background:#fff5f5;border:1px solid #fca5a5;border-radius:7px;padding:12px;}
.alert-title-p{font-size:0.65rem;font-weight:800;color:var(--critical);letter-spacing:0.06em;text-transform:uppercase;margin-bottom:8px;}
.alert-actions-wrap{display:flex;flex-wrap:wrap;gap:4px;}
.alert-action{background:white;border:1px solid #fca5a5;border-radius:5px;padding:3px 8px;font-size:0.68rem;font-weight:700;color:var(--critical);}
.panel-footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px;flex-shrink:0;}

/* ‚îÄ‚îÄ TIME SAVED PANEL ‚îÄ‚îÄ */
.time-saved-panel{width:240px;flex-shrink:0;background:var(--navy);border-left:1px solid rgba(255,255,255,0.07);display:flex;flex-direction:column;overflow:hidden;}
.ts-header{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.07);flex-shrink:0;}
.ts-title{font-size:0.6rem;font-weight:700;letter-spacing:0.16em;text-transform:uppercase;color:rgba(255,255,255,0.35);display:flex;align-items:center;gap:7px;margin-bottom:2px;}
.ts-live-dot{width:6px;height:6px;border-radius:50%;background:#22c55e;animation:pulse 2s infinite;}
.ts-subtitle{font-size:0.72rem;color:rgba(255,255,255,0.6);font-weight:600;}
.ts-body{flex:1;overflow-y:auto;display:flex;flex-direction:column;}
.ts-body::-webkit-scrollbar{width:3px;}
.ts-hero{padding:16px;border-bottom:1px solid rgba(255,255,255,0.06);text-align:center;}
.ts-hero-num{font-family:'IBM Plex Mono',monospace;font-size:2.8rem;font-weight:600;color:#4ade80;line-height:1;letter-spacing:-0.02em;}
.ts-hero-unit{font-size:0.85rem;color:rgba(255,255,255,0.3);}
.ts-hero-label{font-size:0.65rem;color:rgba(255,255,255,0.3);margin-top:4px;}
.ts-section{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.06);}
.ts-section-label{font-size:0.58rem;font-weight:700;letter-spacing:0.14em;text-transform:uppercase;color:rgba(255,255,255,0.25);margin-bottom:8px;}
.ts-bar-group{display:flex;flex-direction:column;gap:7px;}
.ts-bar-row{display:flex;flex-direction:column;gap:3px;}
.ts-bar-labels{display:flex;justify-content:space-between;font-size:0.62rem;}
.ts-bar-name{color:rgba(255,255,255,0.32);}
.ts-bar-val{font-family:'IBM Plex Mono',monospace;font-weight:600;}
.ts-bar-val.red{color:#f87171;}
.ts-bar-val.teal{color:#2dd4bf;}
.ts-bar-track{height:6px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;}
.ts-bar-fill{height:100%;border-radius:3px;}
.ts-bar-fill.before{background:linear-gradient(90deg,#dc2626,#f87171);width:100%;}
.ts-bar-fill.after{background:linear-gradient(90deg,#0d9488,#2dd4bf);width:32%;}
.ts-saving-tag{font-size:0.62rem;color:#4ade80;font-weight:700;text-align:right;}
.ts-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;}
.ts-grid-item{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);border-radius:7px;padding:9px;}
.ts-grid-num{font-family:'IBM Plex Mono',monospace;font-size:1.2rem;font-weight:600;line-height:1;margin-bottom:3px;}
.ts-grid-lbl{font-size:0.57rem;color:rgba(255,255,255,0.28);letter-spacing:0.06em;text-transform:uppercase;line-height:1.3;}
.ts-steps{display:flex;flex-direction:column;gap:4px;}
.ts-step{display:flex;align-items:center;gap:6px;font-size:0.68rem;padding:5px 8px;border-radius:5px;border:1px solid transparent;}
.ts-step.cut{background:rgba(220,38,38,0.06);border-color:rgba(220,38,38,0.1);color:rgba(255,255,255,0.2);text-decoration:line-through;text-decoration-color:rgba(220,38,38,0.35);}
.ts-step.kept{background:rgba(13,148,136,0.09);border-color:rgba(13,148,136,0.18);color:#5eead4;}
.ts-step-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.ts-callout{margin:12px 16px 16px;background:rgba(13,148,136,0.08);border:1px solid rgba(13,148,136,0.18);border-radius:8px;padding:12px;}
.ts-callout-num{font-family:'IBM Plex Mono',monospace;font-size:1.4rem;font-weight:600;color:#2dd4bf;margin-bottom:3px;}
.ts-callout-text{font-size:0.67rem;color:rgba(255,255,255,0.3);line-height:1.5;}

/* ‚îÄ‚îÄ DOCTOR VIEW ‚îÄ‚îÄ */
.doctor-layout{display:flex;gap:20px;flex:1;overflow:hidden;}
.patient-sidebar{width:300px;flex-shrink:0;display:flex;flex-direction:column;gap:14px;overflow-y:auto;}
.patient-sidebar::-webkit-scrollbar{width:4px;}
.patient-card-header{background:var(--navy);padding:16px;border-radius:10px 10px 0 0;}
.diagnosis-area{flex:1;display:flex;flex-direction:column;gap:14px;overflow-y:auto;}
.diagnosis-area::-webkit-scrollbar{width:4px;}
.tier-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.tier-card-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.tier-badge{font-size:0.65rem;font-weight:700;padding:3px 8px;border-radius:8px;letter-spacing:0.06em;}
.tier-1-badge{background:var(--blue-light);color:var(--blue);}
.tier-2-badge{background:var(--high-bg);color:var(--high);}
.tier-3-badge{background:var(--surface-3);color:var(--text-3);}
.confidence-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin:8px 0;}
.confidence-fill{height:100%;border-radius:3px;transition:width 1s ease;}
.cf-blue{background:var(--blue);}
.cf-amber{background:var(--amber);}
.cf-gray{background:var(--border-2);}
.evidence-tags{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px;}
.evidence-tag{background:var(--surface-2);border:1px solid var(--border);border-radius:6px;padding:2px 8px;font-size:0.68rem;color:var(--text-2);}
.action-pills{display:flex;flex-wrap:wrap;gap:6px;}
.action-pill{background:white;border:1px solid var(--critical-border);border-radius:6px;padding:4px 10px;font-size:0.72rem;font-weight:700;color:var(--critical);}
.ai-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:40px;text-align:center;}
.ai-spinner{width:48px;height:48px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin 0.8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.ai-status{font-size:0.85rem;color:var(--text-3);}
.ai-dot-pulse::after{content:'...';animation:dotpulse 1.5s infinite;}
@keyframes dotpulse{0%,100%{content:'.';}33%{content:'..';}66%{content:'...';}};

/* ‚îÄ‚îÄ ADMISSION ‚îÄ‚îÄ */
.admission-card{max-width:520px;margin:40px auto;background:var(--surface);border:2px solid var(--border);border-radius:16px;padding:40px;text-align:center;}
.check-circle{width:72px;height:72px;background:var(--medium-bg);border:2px solid var(--medium-border);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:2rem;}
.admission-title{font-size:1.5rem;font-weight:700;margin-bottom:8px;}
.admission-meta{font-size:0.9rem;color:var(--text-2);margin-bottom:6px;}
.admission-sub{font-size:0.82rem;color:var(--text-3);margin-bottom:24px;}
.admission-id{display:inline-block;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;padding:6px 16px;font-family:'IBM Plex Mono',monospace;font-size:0.82rem;color:var(--text-3);margin-bottom:24px;}
.admission-actions{display:flex;gap:10px;justify-content:center;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-backdrop{position:fixed;inset:0;background:rgba(11,30,53,0.55);z-index:200;display:none;align-items:center;justify-content:center;}
.modal-backdrop.show{display:flex;}
.modal{background:white;border-radius:12px;padding:28px;width:420px;box-shadow:0 20px 60px rgba(0,0,0,0.2);}
.modal-title{font-size:1rem;font-weight:700;margin-bottom:6px;}
.modal-sub{font-size:0.8rem;color:var(--text-3);margin-bottom:18px;}
.modal-textarea{width:100%;border:1px solid var(--border-2);border-radius:6px;padding:10px;font-size:0.82rem;font-family:'IBM Plex Sans',sans-serif;color:var(--text);resize:none;height:80px;outline:none;margin-bottom:14px;}
.modal-textarea:focus{border-color:var(--blue);}
.modal-footer{display:flex;gap:8px;justify-content:flex-end;}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--navy);color:white;padding:12px 24px;border-radius:8px;font-size:0.85rem;font-weight:500;z-index:300;opacity:0;transition:opacity 0.3s;pointer-events:none;}
.toast.show{opacity:1;}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.fade-in{animation:fadeIn 0.3s ease both;}

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.progress-wrap{height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin-bottom:6px;}
.progress-fill{height:100%;background:var(--blue);border-radius:2px;transition:width 0.5s ease;}

/* ‚îÄ‚îÄ HISTORY ROW ‚îÄ‚îÄ */
.history-row{padding:8px 0;border-bottom:1px solid var(--border);font-size:0.78rem;}
.history-row:last-child{border-bottom:none;}
.hist-cond{font-weight:600;color:var(--text);}
.hist-det{font-size:0.68rem;color:var(--text-3);font-family:'IBM Plex Mono',monospace;}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 1: ROLE SELECT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="screen-role" style="background:var(--navy);align-items:center;justify-content:center;">
  <div style="text-align:center;max-width:520px;padding:40px;">
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:32px;">
      <div class="logo-box" style="width:48px;height:48px;font-size:1.6rem;border-radius:12px;">+</div>
      <span style="font-size:2rem;font-weight:700;color:white;font-family:'IBM Plex Mono',monospace;">SignalMD</span>
    </div>
    <p style="font-size:0.9rem;color:rgba(255,255,255,0.45);margin-bottom:36px;line-height:1.6;">AI-powered clinical triage for emergency departments.<br>Select your role to continue.</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:32px;">
      <div onclick="selectRole('nurse')" style="background:rgba(255,255,255,0.06);border:1.5px solid rgba(255,255,255,0.1);border-radius:12px;padding:28px 20px;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor='rgba(255,255,255,0.3)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">
        <div style="font-size:2rem;margin-bottom:12px;">üë©‚Äç‚öïÔ∏è</div>
        <div style="font-size:1rem;font-weight:700;color:white;margin-bottom:6px;">Nurse</div>
        <div style="font-size:0.78rem;color:rgba(255,255,255,0.4);line-height:1.5;">Patient intake, vitals, symptom interview & queue management</div>
      </div>
      <div onclick="selectRole('doctor')" style="background:rgba(255,255,255,0.06);border:1.5px solid rgba(255,255,255,0.1);border-radius:12px;padding:28px 20px;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor='rgba(255,255,255,0.3)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">
        <div style="font-size:2rem;margin-bottom:12px;">üë®‚Äç‚öïÔ∏è</div>
        <div style="font-size:1rem;font-weight:700;color:white;margin-bottom:6px;">Doctor</div>
        <div style="font-size:0.78rem;color:rgba(255,255,255,0.4);line-height:1.5;">Review AI diagnosis, manage queue & confirm admissions</div>
      </div>
    </div>
    <p style="font-size:0.72rem;color:rgba(255,255,255,0.2);">SignalMD ¬∑ Emergency Department Triage Platform</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 2: PATIENT INTAKE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-intake">
  <div class="topbar">
    <div class="logo"><div class="logo-box">+</div><span class="logo-text">SignalMD</span></div>
    <div class="topbar-divider"></div>
    <div class="ward-tabs">
      <div class="ward-tab active">Emergency Dept</div>
    </div>
    <div class="topbar-right">
      <div class="live-badge"><div class="pulse"></div> LIVE</div>
      <div class="role-badge" id="role-badge-intake">üë©‚Äç‚öïÔ∏è Nurse View</div>
      <div class="topbar-avatar" id="avatar-intake">RN</div>
    </div>
  </div>
  <div class="steps-bar">
    <div class="step-item active" id="step-1"><div class="step-num">1</div><span class="step-label">Patient Intake</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item" id="step-2"><div class="step-num">2</div><span class="step-label">Symptom Interview</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item" id="step-3"><div class="step-num">3</div><span class="step-label">Severity Queue</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item" id="step-4"><div class="step-num">4</div><span class="step-label">Doctor View</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item" id="step-5"><div class="step-num">5</div><span class="step-label">Admission</span></div>
  </div>
  <div class="main-content">
    <div class="content-area">
      <div style="max-width:820px;margin:0 auto;">
        <div style="margin-bottom:24px;">
          <h1 style="font-size:1.6rem;font-weight:700;margin-bottom:4px;">New Patient Intake</h1>
          <p style="color:var(--text-3);font-size:0.9rem;">Enter patient information to begin triage assessment</p>
        </div>

        <div class="card fade-in" style="margin-bottom:16px;">
          <div class="card-header"><span class="card-title">Personal Information</span></div>
          <div class="card-body">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">First Name *</label>
                <input class="form-input" id="f-firstname" type="text" placeholder="Enter first name">
              </div>
              <div class="form-group">
                <label class="form-label">Last Name *</label>
                <input class="form-input" id="f-lastname" type="text" placeholder="Enter last name">
              </div>
              <div class="form-group">
                <label class="form-label">Date of Birth *</label>
                <input class="form-input" id="f-dob" type="date">
              </div>
              <div class="form-group">
                <label class="form-label">Gender</label>
                <select class="form-select" id="f-gender">
                  <option value="">Select gender</option>
                  <option>Male</option><option>Female</option><option>Non-binary</option><option>Prefer not to say</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Patient ID</label>
                <input class="form-input" id="f-pid" type="text" placeholder="Auto-generated" readonly style="background:var(--surface-3);color:var(--text-3);">
              </div>
              <div class="form-group">
                <label class="form-label">Insurance</label>
                <select class="form-select" id="f-insurance">
                  <option value="">Select insurance</option>
                  <option>BlueCross PPO</option><option>Aetna HMO</option><option>Cigna</option><option>Medicare</option><option>Medicaid</option><option>Uninsured</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Ward</label>
                <select class="form-select" id="f-ward">
                  <option>Emergency</option><option>Cardiology</option><option>General</option><option>Neurology</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Arrival Mode</label>
                <select class="form-select" id="f-arrival">
                  <option>Walk-in</option><option>Ambulance</option><option>Transfer</option><option>Air transport</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="card fade-in" style="margin-bottom:16px;">
          <div class="card-header"><span class="card-title">Medical History</span></div>
          <div class="card-body">
            <div class="form-grid">
              <div class="form-group full">
                <label class="form-label">Known Conditions</label>
                <div class="symptom-grid" id="condition-tags">
                  <span class="sym-tag" onclick="toggleTag(this)">Hypertension</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Type 2 Diabetes</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Heart Disease</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Asthma/COPD</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Hyperlipidemia</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Atrial Fibrillation</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Kidney Disease</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Stroke History</span>
                  <span class="sym-tag" onclick="toggleTag(this)">Cancer</span>
                  <span class="sym-tag" onclick="toggleTag(this)">None known</span>
                </div>
              </div>
              <div class="form-group full">
                <label class="form-label">Current Medications</label>
                <input class="form-input" id="f-meds" type="text" placeholder="e.g. Lisinopril 10mg, Metformin 500mg, Aspirin 81mg">
              </div>
              <div class="form-group full">
                <label class="form-label">Allergies</label>
                <input class="form-input" id="f-allergies" type="text" placeholder="e.g. Penicillin, Sulfa drugs, Latex, None known">
              </div>
            </div>
          </div>
        </div>

        <div class="card fade-in" style="margin-bottom:24px;">
          <div class="card-header"><span class="card-title">Chief Complaint</span></div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Describe the primary reason for this visit *</label>
              <textarea class="form-textarea" id="f-complaint" placeholder="Describe the patient's chief complaint, onset, duration, and any associated symptoms..." rows="4"></textarea>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;">
          <button class="btn btn-ghost" onclick="goToRole()">‚Üê Back</button>
          <button class="btn btn-primary" onclick="submitIntake()">Continue to Symptoms ‚Üí</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 3: SYMPTOM INTERVIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-symptoms">
  <div class="topbar">
    <div class="logo"><div class="logo-box">+</div><span class="logo-text">SignalMD</span></div>
    <div class="topbar-divider"></div>
    <div class="topbar-right">
      <div class="live-badge"><div class="pulse"></div> LIVE</div>
      <div class="role-badge">üë©‚Äç‚öïÔ∏è Nurse View</div>
      <div class="topbar-avatar">RN</div>
    </div>
  </div>
  <div class="steps-bar">
    <div class="step-item done"><div class="step-num">‚úì</div><span class="step-label">Patient Intake</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item active"><div class="step-num">2</div><span class="step-label">Symptom Interview</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item"><div class="step-num">3</div><span class="step-label">Severity Queue</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item"><div class="step-num">4</div><span class="step-label">Doctor View</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item"><div class="step-num">5</div><span class="step-label">Admission</span></div>
  </div>
  <div class="main-content">
    <div class="content-area">
      <div style="max-width:820px;margin:0 auto;">
        <div style="margin-bottom:24px;display:flex;align-items:flex-start;justify-content:space-between;">
          <div>
            <h1 style="font-size:1.6rem;font-weight:700;margin-bottom:4px;">Symptom Interview</h1>
            <p style="color:var(--text-3);font-size:0.9rem;">Patient: <strong id="sym-patient-name">‚Äî</strong></p>
          </div>
        </div>

        <div class="card fade-in" style="margin-bottom:16px;">
          <div class="card-header"><span class="card-title">Presenting Symptoms</span><span style="font-size:0.75rem;color:var(--text-3);">Select all that apply</span></div>
          <div class="card-body">
            <div class="symptom-grid" id="symptom-tags">
              <span class="sym-tag" onclick="toggleTag(this)">Chest Pain</span>
              <span class="sym-tag" onclick="toggleTag(this)">Shortness of Breath</span>
              <span class="sym-tag" onclick="toggleTag(this)">Nausea / Vomiting</span>
              <span class="sym-tag" onclick="toggleTag(this)">Headache</span>
              <span class="sym-tag" onclick="toggleTag(this)">Dizziness</span>
              <span class="sym-tag" onclick="toggleTag(this)">Fever / Chills</span>
              <span class="sym-tag" onclick="toggleTag(this)">Abdominal Pain</span>
              <span class="sym-tag" onclick="toggleTag(this)">Back Pain</span>
              <span class="sym-tag" onclick="toggleTag(this)">Left Arm Pain</span>
              <span class="sym-tag" onclick="toggleTag(this)">Diaphoresis (Sweating)</span>
              <span class="sym-tag" onclick="toggleTag(this)">Palpitations</span>
              <span class="sym-tag" onclick="toggleTag(this)">Confusion / Altered Mental Status</span>
              <span class="sym-tag" onclick="toggleTag(this)">Weakness / Numbness</span>
              <span class="sym-tag" onclick="toggleTag(this)">Facial Droop</span>
              <span class="sym-tag" onclick="toggleTag(this)">Slurred Speech</span>
              <span class="sym-tag" onclick="toggleTag(this)">Cough</span>
              <span class="sym-tag" onclick="toggleTag(this)">Swelling (Extremities)</span>
              <span class="sym-tag" onclick="toggleTag(this)">Loss of Consciousness</span>
              <span class="sym-tag" onclick="toggleTag(this)">Trauma / Injury</span>
              <span class="sym-tag" onclick="toggleTag(this)">Fatigue</span>
            </div>
          </div>
        </div>

        <div class="card fade-in" style="margin-bottom:16px;">
          <div class="card-header"><span class="card-title">Vital Signs</span></div>
          <div class="card-body">
            <div class="vitals-grid">
              <div class="vital-card">
                <div class="vital-label">Heart Rate</div>
                <div class="vital-value" id="hr-val">72</div>
                <div class="vital-unit">bpm</div>
                <input type="range" min="30" max="200" value="72" oninput="updateVital('hr',this.value)">
              </div>
              <div class="vital-card">
                <div class="vital-label">Systolic BP</div>
                <div class="vital-value" id="bp-val">120</div>
                <div class="vital-unit">mmHg</div>
                <input type="range" min="60" max="220" value="120" oninput="updateVital('bp',this.value)">
              </div>
              <div class="vital-card">
                <div class="vital-label">SpO‚ÇÇ</div>
                <div class="vital-value" id="spo2-val">98</div>
                <div class="vital-unit">%</div>
                <input type="range" min="70" max="100" value="98" oninput="updateVital('spo2',this.value)">
              </div>
              <div class="vital-card">
                <div class="vital-label">Temperature</div>
                <div class="vital-value" id="temp-val">98.6</div>
                <div class="vital-unit">¬∞F</div>
                <input type="range" min="95" max="106" step="0.1" value="98.6" oninput="updateVital('temp',this.value)">
              </div>
              <div class="vital-card">
                <div class="vital-label">Pain Score</div>
                <div class="vital-value" id="pain-val">0</div>
                <div class="vital-unit">/ 10</div>
                <input type="range" min="0" max="10" value="0" oninput="updateVital('pain',this.value)">
              </div>
              <div class="vital-card">
                <div class="vital-label">Resp. Rate</div>
                <div class="vital-value" id="rr-val">16</div>
                <div class="vital-unit">breaths/min</div>
                <input type="range" min="8" max="40" value="16" oninput="updateVital('rr',this.value)">
              </div>
            </div>
          </div>
        </div>

        <div class="card fade-in" style="margin-bottom:24px;">
          <div class="card-header"><span class="card-title">Symptom Details</span></div>
          <div class="card-body">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Symptom Onset</label>
                <select class="form-select" id="f-onset">
                  <option>Just now (&lt;1 hour)</option>
                  <option>1‚Äì6 hours ago</option>
                  <option>6‚Äì24 hours ago</option>
                  <option>1‚Äì3 days ago</option>
                  <option>More than 3 days</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Severity Progression</label>
                <select class="form-select" id="f-progression">
                  <option>Sudden onset</option>
                  <option>Gradually worsening</option>
                  <option>Stable</option>
                  <option>Improving</option>
                  <option>Intermittent</option>
                </select>
              </div>
              <div class="form-group full">
                <label class="form-label">Additional Clinical Notes</label>
                <textarea class="form-textarea" id="f-notes" placeholder="Any additional observations, context, or clinical notes..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;">
          <button class="btn btn-ghost" onclick="goTo('screen-intake')">‚Üê Back</button>
          <button class="btn btn-primary" onclick="submitSymptoms()">Analyze & Rank Severity ‚Üí</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 4: SEVERITY QUEUE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-queue">
  <div class="topbar">
    <div class="logo"><div class="logo-box">+</div><span class="logo-text">SignalMD</span></div>
    <div class="topbar-divider"></div>
    <div class="ward-tabs" id="queue-ward-tabs">
      <div class="ward-tab active" onclick="filterWard('all',this)">All Wards <span class="ward-count" id="tab-all">50</span></div>
      <div class="ward-tab" onclick="filterWard('Emergency',this)">Emergency <span class="ward-count">18</span></div>
      <div class="ward-tab" onclick="filterWard('Cardiology',this)">Cardiology <span class="ward-count">12</span></div>
      <div class="ward-tab" onclick="filterWard('General',this)">General <span class="ward-count">11</span></div>
      <div class="ward-tab" onclick="filterWard('Neurology',this)">Neurology <span class="ward-count">9</span></div>
    </div>
    <div class="topbar-right">
      <div class="live-badge"><div class="pulse"></div> LIVE ¬∑ Updated 8s ago</div>
      <div class="role-badge" id="queue-role-badge">üë©‚Äç‚öïÔ∏è Nurse View</div>
      <div class="topbar-avatar" id="queue-avatar">RN</div>
    </div>
  </div>
  <div class="statsbar">
    <div class="stat"><div class="stat-num" id="q-total">51</div><div class="stat-info"><div class="stat-label">Total Patients</div><div class="stat-sub">4 wards active</div></div></div>
    <div class="stat"><div class="stat-num red" id="q-crit">9</div><div class="stat-info"><div class="stat-label">Critical</div><div class="stat-sub">Needs immediate care</div></div></div>
    <div class="stat"><div class="stat-num amber" id="q-high">14</div><div class="stat-info"><div class="stat-label">High Priority</div><div class="stat-sub">Within 30 min</div></div></div>
    <div class="stat"><div class="stat-num green">6</div><div class="stat-info"><div class="stat-label">Doctors On Call</div><div class="stat-sub">3 available now</div></div></div>
    <div class="stat"><div class="stat-num" id="q-wait">47m</div><div class="stat-info"><div class="stat-label">Avg Wait Time</div><div class="stat-sub" id="q-wait-sub">‚Üë 8m from baseline</div></div></div>
    <div class="statsbar-actions">
      <button class="btn btn-ghost btn-sm" onclick="goTo('screen-intake')">+ New Patient</button>
      <button class="btn btn-primary btn-sm" onclick="switchToDoctor()">Switch to Doctor View ‚Üí</button>
    </div>
  </div>
  <div class="toolbar">
    <div class="search-wrap"><span class="search-icon">‚åï</span><input class="search-input" type="text" id="q-search" placeholder="Search name, ID, condition..." oninput="filterQueue()"></div>
    <div style="display:flex;gap:5px;" id="filter-chips">
      <button class="filter-chip active-all" onclick="setSevFilter('all',this)">All</button>
      <button class="filter-chip" onclick="setSevFilter('critical',this)">‚óè Critical</button>
      <button class="filter-chip" onclick="setSevFilter('high',this)">‚óè High</button>
      <button class="filter-chip" onclick="setSevFilter('medium',this)">‚óè Moderate</button>
      <button class="filter-chip" onclick="setSevFilter('low',this)">‚óè Low</button>
    </div>
    <select style="border:1px solid var(--border);border-radius:6px;padding:5px 10px;font-size:0.78rem;background:var(--surface);color:var(--text-2);outline:none;" onchange="sortQueue(this.value)">
      <option value="score">Sort: AI Score ‚Üì</option>
      <option value="wait">Sort: Wait Time ‚Üì</option>
      <option value="name">Sort: Name A‚ÄìZ</option>
    </select>
    <div class="result-count" id="q-result-count">Showing 51 of 51</div>
  </div>
  <div class="main-content" style="overflow:hidden;">
    <div class="table-wrap" id="queue-table-wrap">
      <table id="queue-table">
        <thead>
          <tr>
            <th style="width:40px;">#</th>
            <th>Patient</th>
            <th>Severity</th>
            <th>AI Score</th>
            <th>Vitals</th>
            <th>Symptoms</th>
            <th>Wait</th>
            <th>Ward</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="queue-body"></tbody>
      </table>
    </div>
    <div class="detail-panel hidden" id="detail-panel">
      <div class="panel-header">
        <div class="panel-name" id="panel-name">‚Äî</div>
        <div class="panel-meta" id="panel-meta">‚Äî</div>
        <span class="sev-badge" id="panel-badge">‚Äî</span>
      </div>
      <div class="panel-body">
        <div class="panel-section">
          <div class="panel-section-title">Vital Signs</div>
          <div class="vitals-grid-panel" id="panel-vitals"></div>
        </div>
        <div class="panel-section">
          <div class="panel-section-title">Tiered Diagnosis</div>
          <div id="panel-diag"></div>
        </div>
        <div class="panel-section">
          <div class="panel-section-title">Medical History</div>
          <div id="panel-history"></div>
        </div>
        <div class="panel-section">
          <div class="alert-panel">
            <div class="alert-title-p">‚ö† Immediate Actions</div>
            <div class="alert-actions-wrap" id="panel-actions"></div>
          </div>
        </div>
      </div>
      <div class="panel-footer">
        <button class="btn btn-ghost btn-sm" style="flex:1" onclick="openOverride()">Override Rank</button>
        <button class="btn btn-critical btn-sm" style="flex:1" onclick="sendToDoctor()">Send to Doctor ‚Üí</button>
      </div>
    </div>
    <div class="time-saved-panel">
      <div class="ts-header">
        <div class="ts-title"><div class="ts-live-dot"></div> SignalMD Impact</div>
        <div class="ts-subtitle">Time Saved This Shift</div>
      </div>
      <div class="ts-body">
        <div class="ts-hero">
          <div class="ts-hero-num" id="ts-counter">610<span class="ts-hero-unit">m</span></div>
          <div class="ts-hero-label">minutes saved this shift</div>
        </div>
        <div class="ts-section">
          <div class="ts-section-label">Triage Time per Patient</div>
          <div class="ts-bar-group">
            <div class="ts-bar-row">
              <div class="ts-bar-labels"><span class="ts-bar-name">Without SignalMD</span><span class="ts-bar-val red">18 min</span></div>
              <div class="ts-bar-track"><div class="ts-bar-fill before"></div></div>
            </div>
            <div class="ts-bar-row">
              <div class="ts-bar-labels"><span class="ts-bar-name">With SignalMD</span><span class="ts-bar-val teal">5.8 min</span></div>
              <div class="ts-bar-track"><div class="ts-bar-fill after"></div></div>
            </div>
            <div class="ts-saving-tag">‚Üì 68% faster per patient</div>
          </div>
        </div>
        <div class="ts-section">
          <div class="ts-section-label">This Shift ¬∑ 12 Hours</div>
          <div class="ts-grid">
            <div class="ts-grid-item"><div class="ts-grid-num" style="color:#4ade80" id="ts-seen">51</div><div class="ts-grid-lbl">Patients Triaged</div></div>
            <div class="ts-grid-item"><div class="ts-grid-num" style="color:#60a5fa" id="ts-crit-fast">9</div><div class="ts-grid-lbl">Critical Fast-tracked</div></div>
            <div class="ts-grid-item"><div class="ts-grid-num" style="color:#fbbf24">10.2h</div><div class="ts-grid-lbl">Hours Returned</div></div>
            <div class="ts-grid-item"><div class="ts-grid-num" style="color:#f472b6">5</div><div class="ts-grid-lbl">Manual Steps Removed</div></div>
          </div>
        </div>
        <div class="ts-section">
          <div class="ts-section-label">Workflow Eliminated</div>
          <div class="ts-steps">
            <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Manual chart lookup</div>
            <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Paper symptom form</div>
            <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Verbal severity handoff</div>
            <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Manual queue sorting</div>
            <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Re-entry into EHR</div>
            <div class="ts-step kept"><div class="ts-step-dot" style="background:#2dd4bf"></div>Doctor reviews &amp; confirms</div>
          </div>
        </div>
        <div class="ts-callout">
          <div class="ts-callout-num">3.3M</div>
          <div class="ts-callout-text">preventable readmissions annually ‚Äî reduced when triage is faster and more accurate.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 5: DOCTOR VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-doctor">
  <div class="topbar">
    <div class="logo"><div class="logo-box">+</div><span class="logo-text">SignalMD</span></div>
    <div class="topbar-divider"></div>
    <div class="topbar-right">
      <div class="live-badge"><div class="pulse"></div> LIVE</div>
      <div class="role-badge">üë®‚Äç‚öïÔ∏è Doctor View</div>
      <button class="btn btn-ghost btn-sm" style="color:rgba(255,255,255,0.6);border-color:rgba(255,255,255,0.15);" onclick="goTo('screen-queue')">‚Üê Back to Queue</button>
      <div class="topbar-avatar">MD</div>
    </div>
  </div>
  <div class="steps-bar">
    <div class="step-item done"><div class="step-num">‚úì</div><span class="step-label">Patient Intake</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item done"><div class="step-num">‚úì</div><span class="step-label">Symptom Interview</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item done"><div class="step-num">‚úì</div><span class="step-label">Severity Queue</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item active"><div class="step-num">4</div><span class="step-label">Doctor View</span></div>
    <div class="step-arrow">‚Ä∫</div>
    <div class="step-item"><div class="step-num">5</div><span class="step-label">Admission</span></div>
  </div>
  <div class="main-content">
    <div class="content-area">
      <div class="doctor-layout">
        <!-- Left: Patient Info -->
        <div class="patient-sidebar">
          <div class="card">
            <div class="patient-card-header">
              <div style="font-size:1.1rem;font-weight:700;color:white;margin-bottom:3px;" id="doc-patient-name">‚Äî</div>
              <div style="font-size:0.78rem;color:rgba(255,255,255,0.55);margin-bottom:10px;" id="doc-patient-meta">‚Äî</div>
              <span class="sev-badge" id="doc-sev-badge">‚Äî</span>
            </div>
            <div style="padding:14px;">
              <div style="font-size:0.62rem;font-weight:700;color:var(--text-3);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:10px;">Vital Signs</div>
              <div class="vitals-grid-panel" id="doc-vitals"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><span class="card-title">Medical History</span></div>
            <div style="padding:14px;" id="doc-history"></div>
          </div>
          <div class="card">
            <div class="card-header"><span class="card-title">Chief Complaint</span></div>
            <div style="padding:14px;font-size:0.85rem;color:var(--text-2);line-height:1.6;" id="doc-complaint">‚Äî</div>
          </div>
          <div class="card">
            <div class="card-header"><span class="card-title">Symptoms</span></div>
            <div style="padding:14px;display:flex;flex-wrap:wrap;gap:5px;" id="doc-symptoms"></div>
          </div>
        </div>

        <!-- Right: AI Diagnosis -->
        <div class="diagnosis-area">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;">
            <div>
              <h2 style="font-size:1.2rem;font-weight:700;">AI Diagnosis Engine</h2>
              <p style="font-size:0.8rem;color:var(--text-3);">SignalMD tiered differential diagnosis</p>
            </div>
            <button class="btn btn-ghost btn-sm" onclick="regenerateDiagnosis()" id="regen-btn">‚Üª Re-analyze</button>
          </div>

          <div id="diagnosis-container">
            <div class="ai-loading" id="ai-loading">
              <div class="ai-spinner"></div>
              <div class="ai-status">Analyzing patient data<span class="ai-dot-pulse"></span></div>
              <div style="font-size:0.75rem;color:var(--text-4);">Cross-referencing symptoms, vitals & history</div>
            </div>
          </div>

          <div id="actions-container" style="display:none;">
            <div class="card">
              <div class="card-header">
                <span class="card-title" style="color:var(--critical);">‚ö† Immediate Actions Recommended</span>
              </div>
              <div class="card-body">
                <div class="action-pills" id="action-pills"></div>
              </div>
            </div>

            <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px;">
              <button class="btn btn-ghost" onclick="openOverride()">Override Rank</button>
              <button class="btn btn-success" onclick="confirmAdmit()">Confirm & Admit Patient ‚Üí</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 6: ADMISSION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-admission" style="align-items:center;justify-content:center;background:var(--bg);">
  <div class="topbar" style="position:fixed;top:0;left:0;right:0;">
    <div class="logo"><div class="logo-box">+</div><span class="logo-text">SignalMD</span></div>
    <div class="topbar-right">
      <div class="live-badge"><div class="pulse"></div> LIVE</div>
      <div class="topbar-avatar">MD</div>
    </div>
  </div>
  <div class="admission-card fade-in" style="margin-top:52px;">
    <div class="check-circle">‚úì</div>
    <div class="admission-title">Patient Admitted</div>
    <div class="admission-meta" id="adm-name">‚Äî</div>
    <div class="admission-sub" id="adm-room">‚Äî</div>
    <div class="admission-sub" style="margin-bottom:16px;">Care team notified. Specialist consult requested.</div>
    <div class="admission-id" id="adm-id">‚Äî</div>
    <div style="background:var(--medium-bg);border:1px solid var(--medium-border);border-radius:8px;padding:14px;margin-bottom:24px;text-align:left;">
      <div style="font-size:0.68rem;font-weight:700;color:var(--medium);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:8px;">Post-Admission Feedback</div>
      <div style="font-size:0.82rem;color:var(--text-2);margin-bottom:10px;">Was the AI diagnosis accurate?</div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-success btn-sm" onclick="submitFeedback('accurate')">‚úì Accurate</button>
        <button class="btn btn-ghost btn-sm" onclick="submitFeedback('partial')">~ Partially</button>
        <button class="btn btn-ghost btn-sm" onclick="submitFeedback('inaccurate')">‚úó Inaccurate</button>
      </div>
    </div>
    <div class="admission-actions">
      <button class="btn btn-ghost" onclick="goToRole()">‚Üê New Session</button>
      <button class="btn btn-primary" onclick="goTo('screen-queue')">Back to Queue</button>
    </div>
  </div>
</div>

<!-- OVERRIDE MODAL -->
<div class="modal-backdrop" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-title">Override AI Ranking</div>
    <div class="modal-sub">Provide a clinical reason. This is logged for model improvement.</div>
    <textarea class="modal-textarea" id="override-reason" placeholder="e.g. Patient condition improved after initial assessment. Downgrading from Critical to High."></textarea>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitOverride()">Submit Override</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let appState = {
  role: 'nurse',
  patient: {},
  vitals: { hr:72, bp:120, spo2:98, temp:98.6, pain:0, rr:16 },
  symptoms: [],
  conditions: [],
  currentFilter: 'all',
  currentWard: 'all',
  selectedPatient: null,
  diagnosisData: null,
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PATIENT DATA (50 pre-existing + 1 new)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function rng(seed){let x=Math.sin(seed)*10000;return x-Math.floor(x);}

const firstNames=['Sarah','James','Priya','David','Aisha','Michael','Elena','Carlos','Mei','Robert','Jennifer','Ahmed','Sofia','Kevin','Natasha','Thomas','Yuki','Marcus','Diana','Hassan','Emma','Victor','Leila','Patrick','Zoe','Samuel','Fatima','Oliver','Grace','Andre','Hannah','Ravi','Chloe','Daniel','Nadia','Benjamin','Linh','George','Amara','Felix','Isabella','Tariq','Mia','Joseph','Ingrid','Malik','Laura','Chen','Rosa','Derek'];
const lastNames=['Mitchell','Okafor','Nair','Chen','Kamara','Torres','Vasquez','Kim','Johnson','Patel','Williams','Hassan','Santos','Park','Ivanova','Anderson','Tanaka','Davis','Rossi','Al-Rashid','Clarke','Moreau','Ferreira','O\'Brien','Nakamura','Reyes','Dubois','M√ºller','Petrov','Svensson'];
const conditions=['Chest Pain','Stroke Symptoms','Abdominal Pain','Fever/Infection','Migraine','Trauma','Cardiac Arrest','Respiratory Distress','Sepsis','Fracture','Appendicitis','Arrhythmia','HTN Crisis','Diabetic Crisis','Allergic Reaction','Pneumonia','Kidney Failure','GI Bleed','Pulmonary Embolism','Head Injury'];
const wards=['Emergency','Cardiology','General','Neurology'];
const sympList={
  'Chest Pain':['Chest Pain','SOB','Left Arm Pain','Diaphoresis'],
  'Stroke Symptoms':['Confusion','Slurred Speech','Facial Droop','Weakness'],
  'Abdominal Pain':['Abdominal Pain','Nausea','Vomiting','Fever'],
  'Sepsis':['Fever','Hypotension','Confusion','Tachycardia'],
  default:['Fatigue','Nausea','Pain','Malaise'],
};
const histList=[['Hypertension','Lisinopril 10mg ¬∑ 2019'],['Type 2 Diabetes','Metformin 500mg ¬∑ 2021'],['Hyperlipidemia','Atorvastatin 20mg ¬∑ 2020'],['No significant history','‚Äî']];
const actionsMap={
  critical:['12-lead ECG','Troponin I/T','Chest X-Ray','Aspirin 325mg','IV Access','Cardiology Consult','Continuous Monitoring'],
  high:['CBC/BMP','IV Access','Cardiac Monitor','O2 Supplementation','Specialist Referral'],
  medium:['Vital Signs q1h','Oral Medications','Labs as indicated','Reassess in 2h'],
  low:['Vital Signs q2h','Discharge Instructions','Follow-up Appointment'],
};

let queueData = Array.from({length:50},(_,i)=>{
  const s=i+1;
  const name=firstNames[i]+' '+lastNames[i%lastNames.length];
  const age=22+Math.floor(rng(s*3)*60);
  const sex=rng(s*7)>0.5?'M':'F';
  const cond=conditions[Math.floor(rng(s*11)*conditions.length)];
  const ward=wards[Math.floor(rng(s*13)*wards.length)];
  const score=Math.max(10,Math.min(98,Math.floor(101-(i*1.65)-rng(s*17)*8)));
  const severity=score>=80?'critical':score>=60?'high':score>=35?'medium':'low';
  const waitMins=5+Math.floor(rng(s*19)*130);
  const wait=waitMins<60?`${waitMins}m`:`${Math.floor(waitMins/60)}h ${waitMins%60}m`;
  const hr=severity==='critical'?105+Math.floor(rng(s*23)*30):65+Math.floor(rng(s*23)*40);
  const bp=severity==='critical'?145+Math.floor(rng(s*29)*40):110+Math.floor(rng(s*29)*30);
  const spo2=severity==='critical'?88+Math.floor(rng(s*31)*7):94+Math.floor(rng(s*31)*6);
  const pain=severity==='critical'?7+Math.floor(rng(s*37)*3):2+Math.floor(rng(s*37)*6);
  const syms=(sympList[cond]||sympList.default);
  const pid=`PT-24-${String(8800+i).padStart(4,'0')}`;
  const hist=histList[Math.floor(rng(s*41)*histList.length)];
  const waitM=waitMins;
  return {id:s,name,age,sex,cond,ward,score,severity,wait,waitM,hr,bp,spo2,pain,rr:16+Math.floor(rng(s*43)*8),temp:97+rng(s*47)*3,syms,pid,hist,isNew:false};
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goTo(screenId){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
}

function goToRole(){goTo('screen-role');}

function selectRole(role){
  appState.role=role;
  document.getElementById('role-badge-intake').textContent=role==='nurse'?'üë©‚Äç‚öïÔ∏è Nurse View':'üë®‚Äç‚öïÔ∏è Doctor View';
  document.getElementById('avatar-intake').textContent=role==='nurse'?'RN':'MD';
  document.getElementById('queue-role-badge').textContent=role==='nurse'?'üë©‚Äç‚öïÔ∏è Nurse View':'üë®‚Äç‚öïÔ∏è Doctor View';
  document.getElementById('queue-avatar').textContent=role==='nurse'?'RN':'MD';
  // Generate a patient ID
  document.getElementById('f-pid').value='PT-24-'+String(8851+Math.floor(Math.random()*100)).padStart(4,'0');
  goTo('screen-intake');
}

function switchToDoctor(){
  appState.role='doctor';
  if(appState.selectedPatient){
    openDoctorView(appState.selectedPatient);
  } else {
    openDoctorView(queueData[0]);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INTAKE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleTag(el){el.classList.toggle('selected');}

function submitIntake(){
  const fn=document.getElementById('f-firstname').value.trim();
  const ln=document.getElementById('f-lastname').value.trim();
  if(!fn||!ln){showToast('Please enter patient first and last name');return;}
  const complaint=document.getElementById('f-complaint').value.trim();
  if(!complaint){showToast('Please enter a chief complaint');return;}

  appState.patient={
    name:`${fn} ${ln}`,
    dob:document.getElementById('f-dob').value,
    gender:document.getElementById('f-gender').value||'Unknown',
    pid:document.getElementById('f-pid').value,
    insurance:document.getElementById('f-insurance').value||'Unknown',
    ward:document.getElementById('f-ward').value,
    arrival:document.getElementById('f-arrival').value,
    conditions:[...document.querySelectorAll('#condition-tags .selected')].map(t=>t.textContent),
    meds:document.getElementById('f-meds').value,
    allergies:document.getElementById('f-allergies').value,
    complaint,
  };

  document.getElementById('sym-patient-name').textContent=appState.patient.name;
  goTo('screen-symptoms');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VITALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateVital(type,val){
  const v=parseFloat(val);
  appState.vitals[type]=v;
  const el=document.getElementById(`${type}-val`);
  el.textContent=type==='temp'?v.toFixed(1):Math.round(v);

  let cls='normal';
  if(type==='hr'&&(v>100||v<60))cls=v>100?'red':'amber';
  if(type==='bp'&&(v>140||v<90))cls=v>140?'red':'amber';
  if(type==='spo2'&&v<95)cls=v<90?'red':'amber';
  if(type==='temp'&&v>100.4)cls=v>103?'red':'amber';
  if(type==='pain'&&v>6)cls=v>8?'red':'amber';
  if(type==='rr'&&(v>20||v<12))cls=v>25?'red':'amber';
  el.className='vital-value '+cls;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SYMPTOMS ‚Üí QUEUE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function submitSymptoms(){
  appState.symptoms=[...document.querySelectorAll('#symptom-tags .selected')].map(t=>t.textContent);
  appState.patient.onset=document.getElementById('f-onset').value;
  appState.patient.progression=document.getElementById('f-progression').value;
  appState.patient.notes=document.getElementById('f-notes').value;

  // Calculate AI score from vitals + symptoms
  let score=50;
  const v=appState.vitals;
  if(v.hr>100)score+=10; if(v.hr>130)score+=10;
  if(v.bp>140)score+=8; if(v.bp>170)score+=8;
  if(v.spo2<95)score+=10; if(v.spo2<90)score+=15;
  if(v.pain>6)score+=8; if(v.pain>8)score+=5;
  if(v.temp>100.4)score+=5; if(v.temp>103)score+=8;
  if(v.rr>20)score+=5;
  const critSyms=['Chest Pain','Shortness of Breath','Loss of Consciousness','Facial Droop','Left Arm Pain','Confusion / Altered Mental Status'];
  appState.symptoms.forEach(s=>{if(critSyms.includes(s))score+=6;});
  if(appState.patient.progression==='Sudden onset')score+=5;
  score=Math.min(98,Math.max(15,score));

  const severity=score>=80?'critical':score>=60?'high':score>=35?'medium':'low';

  const age=appState.patient.dob?Math.floor((Date.now()-new Date(appState.patient.dob))/(365.25*24*3600*1000)):45;
  const newPat={
    id:0,name:appState.patient.name,age,sex:appState.patient.gender[0]||'?',
    cond:appState.symptoms[0]||'Chief Complaint',ward:appState.patient.ward,
    score,severity,wait:'Just now',waitM:0,
    hr:v.hr,bp:v.bp,spo2:v.spo2,pain:v.pain,rr:v.rr,temp:v.temp,
    syms:appState.symptoms.slice(0,4),
    pid:appState.patient.pid,
    hist:[appState.patient.conditions.join(', ')||'None known',appState.patient.meds||'None'],
    complaint:appState.patient.complaint,
    isNew:true,
  };

  queueData.unshift(newPat);
  // re-sort
  queueData.sort((a,b)=>b.score-a.score);
  queueData.forEach((p,i)=>p.id=i+1);

  // update stats
  const critCount=queueData.filter(p=>p.severity==='critical').length;
  const highCount=queueData.filter(p=>p.severity==='high').length;
  document.getElementById('q-total').textContent=queueData.length;
  document.getElementById('q-crit').textContent=critCount;
  document.getElementById('q-high').textContent=highCount;
  document.getElementById('ts-seen').textContent=queueData.length;
  document.getElementById('ts-crit-fast').textContent=critCount;
  document.getElementById('tab-all').textContent=queueData.length;

  renderQueue();
  goTo('screen-queue');

  // Flash the new patient
  setTimeout(()=>{
    const rows=document.querySelectorAll('#queue-body tr');
    rows.forEach(r=>{if(r.dataset.pid===newPat.pid){r.style.background='rgba(26,107,181,0.15)';setTimeout(()=>{r.style.background='';},2000);}});
  },200);

  showToast(`‚úì ${newPat.name} added to queue ‚Äî AI Score: ${score} (${severity.toUpperCase()})`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QUEUE RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getSevClass(s){return{critical:'sev-critical',high:'sev-high',medium:'sev-medium',low:'sev-low'}[s];}
function getSevLabel(s){return{critical:'‚óè Critical',high:'‚óè High',medium:'‚óè Moderate',low:'‚óè Low'}[s];}
function getFillClass(s){return{critical:'fill-critical',high:'fill-high',medium:'fill-medium',low:'fill-low'}[s];}

let currentSort='score';

function renderQueue(){
  const search=document.getElementById('q-search').value.toLowerCase();
  const filt=appState.currentFilter;
  const ward=appState.currentWard;

  let data=[...queueData];
  if(filt!=='all')data=data.filter(p=>p.severity===filt);
  if(ward!=='all')data=data.filter(p=>p.ward===ward);
  if(search)data=data.filter(p=>p.name.toLowerCase().includes(search)||p.pid.toLowerCase().includes(search)||p.cond.toLowerCase().includes(search));

  if(currentSort==='score')data.sort((a,b)=>b.score-a.score);
  else if(currentSort==='wait')data.sort((a,b)=>b.waitM-a.waitM);
  else if(currentSort==='name')data.sort((a,b)=>a.name.localeCompare(b.name));

  document.getElementById('q-result-count').textContent=`Showing ${data.length} of ${queueData.length}`;

  const body=document.getElementById('queue-body');
  body.innerHTML='';

  data.forEach((p,ri)=>{
    const hrCol=p.hr>100?'val-red':p.hr>90?'val-amber':'val-green';
    const bpCol=p.bp>140?'val-red':p.bp>130?'val-amber':'val-green';
    const spCol=p.spo2<90?'val-red':p.spo2<95?'val-amber':'val-green';
    const waitCol=p.waitM<20?'wait-urgent':p.waitM<60?'wait-warn':'';
    const isNew=p.isNew?'style="background:rgba(26,107,181,0.06)"':'';

    const symsHtml=p.syms.slice(0,3).map(s=>`<span style="background:var(--surface-3);border:1px solid var(--border);border-radius:6px;padding:1px 6px;font-size:0.62rem;color:var(--text-2);margin-right:3px;">${s}</span>`).join('');

    const tr=document.createElement('tr');
    tr.className=`${p.severity}-row${appState.selectedPatient?.pid===p.pid?' selected':''}`;
    tr.dataset.pid=p.pid;
    if(p.isNew)tr.style.background='rgba(26,107,181,0.04)';
    tr.innerHTML=`
      <td class="rank-cell" style="font-family:'IBM Plex Mono',monospace;font-size:0.72rem;color:var(--text-3);">${ri+1}</td>
      <td>
        <div class="patient-name">${p.name}${p.isNew?'<span style="background:var(--blue);color:white;font-size:0.6rem;padding:1px 6px;border-radius:8px;margin-left:6px;font-weight:700;">NEW</span>':''}</div>
        <div class="patient-meta">${p.age}${p.sex} ¬∑ ${p.cond} ¬∑ ${p.pid}</div>
      </td>
      <td><span class="sev-badge ${getSevClass(p.severity)}">${getSevLabel(p.severity)}</span></td>
      <td>
        <div class="score-row">
          <div class="score-bar"><div class="score-fill ${getFillClass(p.severity)}" style="width:${p.score}%"></div></div>
          <span class="score-num">${p.score}</span>
        </div>
      </td>
      <td class="vital-compact">
        <div><span class="${hrCol}">HR ${p.hr}</span></div>
        <div><span class="${bpCol}">BP ${p.bp}/90</span></div>
        <div><span class="${spCol}">O‚ÇÇ ${p.spo2}%</span></div>
      </td>
      <td>${symsHtml}</td>
      <td class="${waitCol}" style="font-family:'IBM Plex Mono',monospace;font-size:0.78rem;font-weight:600;">${p.wait}</td>
      <td style="font-size:0.72rem;color:var(--text-3);font-family:'IBM Plex Mono',monospace;">${p.ward}</td>
      <td>
        ${p.severity==='critical'?
          `<button class="tbl-btn tbl-btn-primary" onclick="event.stopPropagation();openDoctorView(queueData.find(x=>x.pid==='${p.pid}'))">See Now</button>`:
          `<button class="tbl-btn tbl-btn-ghost" onclick="event.stopPropagation();selectRow('${p.pid}')">View</button>`
        }
      </td>
    `;
    tr.onclick=()=>selectRow(p.pid);
    body.appendChild(tr);
  });
}

function selectRow(pid){
  const p=queueData.find(x=>x.pid===pid);
  if(!p)return;
  appState.selectedPatient=p;
  document.querySelectorAll('#queue-body tr').forEach(r=>r.classList.remove('selected'));
  document.querySelector(`[data-pid="${pid}"]`)?.classList.add('selected');
  openDetailPanel(p);
}

function openDetailPanel(p){
  const panel=document.getElementById('detail-panel');
  panel.classList.remove('hidden');

  document.getElementById('panel-name').textContent=p.name;
  document.getElementById('panel-meta').textContent=`${p.age}${p.sex} ¬∑ ${p.pid}`;
  const badge=document.getElementById('panel-badge');
  badge.textContent=getSevLabel(p.severity);
  badge.className='sev-badge '+getSevClass(p.severity);

  const vg=document.getElementById('panel-vitals');
  vg.innerHTML=`
    <div class="vital-panel-item"><div class="vital-panel-label">Heart Rate</div><div class="vital-panel-val" style="color:${p.hr>100?'var(--critical)':p.hr>90?'var(--amber)':'var(--text)'}">${p.hr} <span style="font-size:0.65rem;color:var(--text-3);">bpm</span></div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">Blood Pressure</div><div class="vital-panel-val" style="color:${p.bp>140?'var(--critical)':p.bp>130?'var(--amber)':'var(--text)'}">${p.bp}/90</div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">SpO‚ÇÇ</div><div class="vital-panel-val" style="color:${p.spo2<90?'var(--critical)':p.spo2<95?'var(--amber)':'var(--green)'}">${p.spo2}%</div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">Pain Score</div><div class="vital-panel-val" style="color:${p.pain>7?'var(--critical)':p.pain>5?'var(--amber)':'var(--text)'}">${p.pain}/10</div></div>
  `;

  const dg=document.getElementById('panel-diag');
  const tiers=getQuickTiers(p);
  dg.innerHTML=tiers.map((t,i)=>`
    <div class="diag-tier t${i+1}">
      <div class="tier-label">Tier ${i+1} ¬∑ ${i===0?'Primary':'Differential'}</div>
      <div class="tier-name">${t.name}</div>
      <div class="tier-conf">Confidence: ${t.conf}%</div>
      <div class="conf-bar"><div class="conf-fill" style="width:${t.conf}%;background:${i===0?'var(--blue)':i===1?'var(--amber)':'var(--border-2)'}"></div></div>
    </div>
  `).join('');

  const hg=document.getElementById('panel-history');
  hg.innerHTML=`<div class="history-row"><div class="hist-cond">${Array.isArray(p.hist)?p.hist[0]:p.hist}</div><div class="hist-det">${Array.isArray(p.hist)?p.hist[1]:''}</div></div>`;

  const acts=actionsMap[p.severity]||actionsMap.medium;
  document.getElementById('panel-actions').innerHTML=acts.slice(0,5).map(a=>`<span class="alert-action">${a}</span>`).join('');
}

function getQuickTiers(p){
  const map={
    'Chest Pain':[{name:'Acute Myocardial Infarction',conf:85},{name:'Unstable Angina',conf:60},{name:'Pulmonary Embolism',conf:25}],
    'Stroke Symptoms':[{name:'Ischemic Stroke',conf:82},{name:'TIA',conf:55},{name:'Complex Migraine',conf:20}],
    'Sepsis':[{name:'Septic Shock',conf:88},{name:'Severe Sepsis',conf:65},{name:'Pneumonia',conf:30}],
    'Respiratory Distress':[{name:'Acute Respiratory Failure',conf:80},{name:'Pulmonary Embolism',conf:58},{name:'COPD Exacerbation',conf:35}],
    default:[{name:'Acute Presentation ‚Äî Pending',conf:70},{name:'Differential Pending',conf:45},{name:'Monitor & Reassess',conf:20}],
  };
  return (map[p.cond]||map.default);
}

function sendToDoctor(){
  if(!appState.selectedPatient)return;
  openDoctorView(appState.selectedPatient);
}

function closePanel(){
  document.getElementById('detail-panel').classList.add('hidden');
  appState.selectedPatient=null;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOCTOR VIEW + AI DIAGNOSIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDoctorView(p){
  appState.selectedPatient=p;
  appState.diagnosisData=null;

  document.getElementById('doc-patient-name').textContent=p.name;
  const age=p.age||45; const sex=p.sex||'?';
  document.getElementById('doc-patient-meta').textContent=`${age}${sex} ¬∑ ${p.pid} ¬∑ ${p.ward}`;
  const badge=document.getElementById('doc-sev-badge');
  badge.textContent=`${getSevLabel(p.severity)} ‚Äî Score ${p.score}`;
  badge.className='sev-badge '+getSevClass(p.severity);

  document.getElementById('doc-vitals').innerHTML=`
    <div class="vital-panel-item"><div class="vital-panel-label">Heart Rate</div><div class="vital-panel-val" style="color:${p.hr>100?'var(--critical)':p.hr>90?'var(--amber)':'var(--text)'}">${p.hr} <small style="font-size:0.6rem;color:var(--text-3);">bpm</small></div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">Blood Pressure</div><div class="vital-panel-val" style="color:${p.bp>140?'var(--critical)':p.bp>130?'var(--amber)':'var(--text)'}">${p.bp}/90</div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">SpO‚ÇÇ</div><div class="vital-panel-val" style="color:${p.spo2<90?'var(--critical)':p.spo2<95?'var(--amber)':'var(--green)'}">${p.spo2}%</div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">Temperature</div><div class="vital-panel-val">${typeof p.temp==='number'?p.temp.toFixed(1):p.temp}¬∞F</div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">Pain Score</div><div class="vital-panel-val" style="color:${p.pain>7?'var(--critical)':p.pain>5?'var(--amber)':'var(--text)'}">${p.pain}/10</div></div>
    <div class="vital-panel-item"><div class="vital-panel-label">Resp. Rate</div><div class="vital-panel-val">${p.rr}/min</div></div>
  `;

  const hist=Array.isArray(p.hist)?p.hist:[p.hist,''];
  document.getElementById('doc-history').innerHTML=`
    <div class="history-row"><div class="hist-cond">${hist[0]||'None known'}</div><div class="hist-det">${hist[1]||''}</div></div>
  `;

  document.getElementById('doc-complaint').textContent=p.complaint||p.cond||'See presenting symptoms';

  document.getElementById('doc-symptoms').innerHTML=(p.syms||[]).map(s=>
    `<span class="sev-badge sev-low" style="margin:2px;">${s}</span>`
  ).join('');

  document.getElementById('actions-container').style.display='none';
  document.getElementById('diagnosis-container').innerHTML=`
    <div class="ai-loading" id="ai-loading">
      <div class="ai-spinner"></div>
      <div class="ai-status">Analyzing patient data<span class="ai-dot-pulse"></span></div>
      <div style="font-size:0.75rem;color:var(--text-4);">Cross-referencing symptoms, vitals & history</div>
    </div>
  `;

  goTo('screen-doctor');
  runAIDiagnosis(p);
}

async function runAIDiagnosis(p){
  const prompt=`You are SignalMD, an AI clinical triage assistant for emergency departments.

Patient: ${p.name}, ${p.age||'?'} years old, ${p.sex==='M'?'Male':'Female'}
Chief complaint: ${p.complaint||p.cond}
Symptoms: ${(p.syms||[]).join(', ')}
Vitals: HR ${p.hr} bpm, BP ${p.bp}/90 mmHg, SpO2 ${p.spo2}%, Temp ${typeof p.temp==='number'?p.temp.toFixed(1):p.temp}¬∞F, Pain ${p.pain}/10, RR ${p.rr}/min
Medical history: ${Array.isArray(p.hist)?p.hist.join(' ‚Äî '):p.hist||'Unknown'}
AI Severity Score: ${p.score}/100 (${p.severity})

Provide a clinical triage diagnosis in this EXACT JSON format (no markdown, no extra text):
{
  "summary": "2-3 sentence clinical summary of the presentation",
  "tier1": {"diagnosis": "Primary diagnosis name", "confidence": 85, "rationale": "Brief clinical rationale", "evidence": ["symptom1", "symptom2", "vital finding"]},
  "tier2": {"diagnosis": "Differential diagnosis", "confidence": 55, "rationale": "Brief rationale", "evidence": ["finding1", "finding2"]},
  "tier3": {"diagnosis": "Third possibility", "confidence": 25, "rationale": "Brief rationale", "evidence": ["finding1"]},
  "immediateActions": ["Action 1", "Action 2", "Action 3", "Action 4", "Action 5"],
  "admitTo": "Department name (e.g. Cardiology ICU, General Medicine, Neurology)"
}`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{ role: 'user', content: prompt }]
      })
    });
    const data = await response.json();
    const text = data.content?.map(c=>c.text||'').join('') || '';
    const clean = text.replace(/```json|```/g,'').trim();
    const result = JSON.parse(clean);
    appState.diagnosisData = result;
    renderDiagnosis(result, p);
  } catch(e) {
    // Fallback diagnosis if API unavailable
    const fallback = generateFallbackDiagnosis(p);
    appState.diagnosisData = fallback;
    renderDiagnosis(fallback, p);
  }
}

function generateFallbackDiagnosis(p){
  const tiers = getQuickTiers(p);
  const acts = actionsMap[p.severity] || actionsMap.medium;
  return {
    summary: `Patient presents with ${p.cond||'acute symptoms'} with AI severity score of ${p.score}/100. Vitals indicate ${p.hr>100?'tachycardia':'normal heart rate'}, ${p.bp>140?'hypertension':'normal blood pressure'}, and SpO‚ÇÇ of ${p.spo2}%. Requires ${p.severity} priority assessment.`,
    tier1: {diagnosis:tiers[0].name, confidence:tiers[0].conf, rationale:'Based on presenting symptoms and vital signs pattern.', evidence:p.syms?.slice(0,3)||[]},
    tier2: {diagnosis:tiers[1].name, confidence:tiers[1].conf, rationale:'Alternative diagnosis based on symptom overlap.', evidence:p.syms?.slice(1,3)||[]},
    tier3: {diagnosis:tiers[2].name, confidence:tiers[2].conf, rationale:'Less likely but should be considered.', evidence:[p.syms?.[0]||'symptom pattern']},
    immediateActions: acts.slice(0,5),
    admitTo: p.ward+' Unit',
  };
}

function renderDiagnosis(result, p){
  const container = document.getElementById('diagnosis-container');
  container.innerHTML = `
    <div class="card fade-in" style="margin-bottom:14px;">
      <div class="card-header"><span class="card-title">Clinical Summary</span></div>
      <div class="card-body">
        <p style="font-size:0.88rem;color:var(--text-2);line-height:1.7;">${result.summary}</p>
        ${result.admitTo?`<div style="margin-top:12px;display:flex;align-items:center;gap:8px;"><span style="font-size:0.72rem;color:var(--text-3);font-weight:700;text-transform:uppercase;letter-spacing:0.08em;">Recommended Admission:</span><span style="background:var(--blue-light);color:var(--blue);border-radius:6px;padding:3px 10px;font-size:0.8rem;font-weight:600;">${result.admitTo}</span></div>`:''}
      </div>
    </div>

    <div class="tier-card fade-in" style="margin-bottom:10px;">
      <div class="tier-card-header">
        <div>
          <span class="tier-badge tier-1-badge">Tier 1 ¬∑ Primary Diagnosis</span>
          <div style="font-size:1rem;font-weight:700;margin-top:6px;">${result.tier1.diagnosis}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-size:1.4rem;font-weight:700;font-family:'IBM Plex Mono',monospace;color:var(--blue);">${result.tier1.confidence}%</div>
          <div style="font-size:0.65rem;color:var(--text-3);">confidence</div>
        </div>
      </div>
      <div class="card-body" style="padding:12px 16px;">
        <div class="confidence-bar"><div class="confidence-fill cf-blue" style="width:${result.tier1.confidence}%"></div></div>
        <p style="font-size:0.82rem;color:var(--text-2);margin-bottom:10px;">${result.tier1.rationale}</p>
        <div class="evidence-tags">${(result.tier1.evidence||[]).map(e=>`<span class="evidence-tag">${e}</span>`).join('')}</div>
      </div>
    </div>

    <div class="tier-card fade-in" style="margin-bottom:10px;">
      <div class="tier-card-header">
        <div>
          <span class="tier-badge tier-2-badge">Tier 2 ¬∑ Differential</span>
          <div style="font-size:0.95rem;font-weight:700;margin-top:6px;">${result.tier2.diagnosis}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-size:1.3rem;font-weight:700;font-family:'IBM Plex Mono',monospace;color:var(--amber);">${result.tier2.confidence}%</div>
          <div style="font-size:0.65rem;color:var(--text-3);">confidence</div>
        </div>
      </div>
      <div class="card-body" style="padding:12px 16px;">
        <div class="confidence-bar"><div class="confidence-fill cf-amber" style="width:${result.tier2.confidence}%"></div></div>
        <p style="font-size:0.82rem;color:var(--text-2);margin-bottom:10px;">${result.tier2.rationale}</p>
        <div class="evidence-tags">${(result.tier2.evidence||[]).map(e=>`<span class="evidence-tag">${e}</span>`).join('')}</div>
      </div>
    </div>

    <div class="tier-card fade-in" style="margin-bottom:14px;">
      <div class="tier-card-header">
        <div>
          <span class="tier-badge tier-3-badge">Tier 3 ¬∑ Consider</span>
          <div style="font-size:0.9rem;font-weight:700;margin-top:6px;">${result.tier3.diagnosis}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-size:1.2rem;font-weight:700;font-family:'IBM Plex Mono',monospace;color:var(--text-3);">${result.tier3.confidence}%</div>
          <div style="font-size:0.65rem;color:var(--text-3);">confidence</div>
        </div>
      </div>
      <div class="card-body" style="padding:12px 16px;">
        <div class="confidence-bar"><div class="confidence-fill cf-gray" style="width:${result.tier3.confidence}%"></div></div>
        <p style="font-size:0.82rem;color:var(--text-2);margin-bottom:10px;">${result.tier3.rationale}</p>
        <div class="evidence-tags">${(result.tier3.evidence||[]).map(e=>`<span class="evidence-tag">${e}</span>`).join('')}</div>
      </div>
    </div>
  `;

  // Immediate actions
  const actContainer = document.getElementById('actions-container');
  actContainer.style.display='block';
  document.getElementById('action-pills').innerHTML=(result.immediateActions||[]).map(a=>`<span class="action-pill">${a}</span>`).join('');
}

function regenerateDiagnosis(){
  if(!appState.selectedPatient)return;
  document.getElementById('actions-container').style.display='none';
  document.getElementById('diagnosis-container').innerHTML=`
    <div class="ai-loading">
      <div class="ai-spinner"></div>
      <div class="ai-status">Re-analyzing<span class="ai-dot-pulse"></span></div>
    </div>
  `;
  runAIDiagnosis(appState.selectedPatient);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMISSION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function confirmAdmit(){
  const p=appState.selectedPatient;
  if(!p)return;
  const admitTo=appState.diagnosisData?.admitTo||p.ward;
  const roomNum=Math.floor(Math.random()*20)+100;
  document.getElementById('adm-name').textContent=`${p.name} ‚Äî ${admitTo}, Room ${roomNum}`;
  document.getElementById('adm-room').textContent=`Admitted at ${new Date().toLocaleTimeString()}`;
  document.getElementById('adm-id').textContent=`ADM-2024-${p.pid?.split('-').pop()||'8821'} ¬∑ ${new Date().toLocaleTimeString()}`;

  // Remove from queue
  const idx=queueData.findIndex(x=>x.pid===p.pid);
  if(idx>-1)queueData.splice(idx,1);
  queueData.forEach((pt,i)=>pt.id=i+1);

  goTo('screen-admission');
}

function submitFeedback(type){
  const msgs={accurate:'‚úì Feedback recorded ‚Äî AI model updated',partial:'~ Partial match noted ‚Äî logged for review',inaccurate:'‚úó Disagreement logged ‚Äî case flagged for review'};
  showToast(msgs[type]);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILTERS & SORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setSevFilter(f,btn){
  appState.currentFilter=f;
  document.querySelectorAll('.filter-chip').forEach(c=>c.className='filter-chip');
  btn.className=`filter-chip active-${f}`;
  renderQueue();
}

function filterWard(ward,tab){
  appState.currentWard=ward;
  document.querySelectorAll('.ward-tab').forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
  renderQueue();
}

function filterQueue(){renderQueue();}
function sortQueue(val){currentSort=val;renderQueue();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL & OVERRIDE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openOverride(){document.getElementById('modal').classList.add('show');}
function closeModal(){document.getElementById('modal').classList.remove('show');}
function submitOverride(){
  const reason=document.getElementById('override-reason').value.trim();
  if(!reason){showToast('Please provide a reason for override');return;}
  closeModal();
  showToast('‚úì Override submitted ‚Äî logged for AI improvement');
  document.getElementById('override-reason').value='';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
renderQueue();

// Live clock update in topbar
setInterval(()=>{
  const liveEls=document.querySelectorAll('.live-badge');
  const secs=Math.floor(Date.now()/1000)%60;
  liveEls.forEach(el=>{
    if(el.textContent.includes('ago'))el.innerHTML=`<div class="pulse" style="width:7px;height:7px;border-radius:50%;background:#22c55e;animation:pulse 2s infinite;"></div> LIVE ¬∑ Updated ${secs}s ago`;
  });
},5000);
</script>
</body>
</html>
