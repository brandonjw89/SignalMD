<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SignalMD — Queue at Scale</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #f0f3f7;
  --surface: #ffffff;
  --surface-2: #f7f9fb;
  --surface-3: #eef1f6;
  --border: #dde3ec;
  --border-2: #c8d0dc;
  --navy: #0b1e35;
  --navy-2: #152d4a;
  --navy-3: #1e3d63;
  --blue: #1760b4;
  --blue-2: #2075d6;
  --blue-light: #e3edf9;
  --text: #0d1f33;
  --text-2: #3d5166;
  --text-3: #7a92a8;
  --text-4: #a8bccf;

  --critical: #c0392b;
  --critical-bg: #fef2f2;
  --critical-border: #fca5a5;
  --critical-dim: rgba(192,57,43,0.08);

  --high: #b45309;
  --high-bg: #fffbeb;
  --high-border: #fcd34d;

  --medium: #047857;
  --medium-bg: #f0fdf4;
  --medium-border: #6ee7b7;

  --low: #1760b4;
  --low-bg: #eff6ff;
  --low-border: #93c5fd;

  --green: #16a34a;
  --amber: #d97706;
}

body {
  font-family: 'IBM Plex Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ── TOPBAR ── */
.topbar {
  background: var(--navy);
  height: 52px;
  display: flex;
  align-items: center;
  padding: 0 20px;
  gap: 0;
  flex-shrink: 0;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

.logo {
  display: flex;
  align-items: center;
  gap: 9px;
  margin-right: 32px;
}

.logo-box {
  width: 28px; height: 28px;
  background: var(--blue-2);
  border-radius: 7px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; font-weight: 700; color: white;
  font-family: 'IBM Plex Mono', monospace;
}

.logo-text {
  font-family: 'IBM Plex Sans', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  color: white;
  letter-spacing: -0.01em;
}

.topbar-divider {
  width: 1px; height: 28px;
  background: rgba(255,255,255,0.1);
  margin: 0 20px;
}

.ward-tabs {
  display: flex;
  gap: 2px;
  height: 52px;
  align-items: flex-end;
}

.ward-tab {
  padding: 8px 16px;
  font-size: 0.75rem;
  font-weight: 600;
  color: rgba(255,255,255,0.45);
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  gap: 7px;
  letter-spacing: 0.02em;
  border-bottom: 2px solid transparent;
  position: relative;
  top: 1px;
}

.ward-tab:hover { color: rgba(255,255,255,0.75); background: rgba(255,255,255,0.05); }

.ward-tab.active {
  color: white;
  background: var(--bg);
  border-color: transparent;
  border-bottom-color: var(--bg);
  color: var(--navy);
}

.ward-count {
  background: rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.7);
  border-radius: 10px;
  padding: 1px 7px;
  font-size: 0.68rem;
  font-family: 'IBM Plex Mono', monospace;
}

.ward-tab.active .ward-count {
  background: var(--critical-bg);
  color: var(--critical);
}

.topbar-right {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 14px;
}

.live-badge {
  display: flex; align-items: center; gap: 6px;
  font-size: 0.7rem;
  color: rgba(255,255,255,0.5);
  font-family: 'IBM Plex Mono', monospace;
}

.pulse {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: #22c55e;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%,100% { box-shadow: 0 0 0 0 rgba(34,197,94,0.4); }
  50% { box-shadow: 0 0 0 5px rgba(34,197,94,0); }
}

.topbar-avatar {
  width: 30px; height: 30px;
  border-radius: 50%;
  background: var(--navy-3);
  border: 1px solid rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.65rem; font-weight: 700; color: rgba(255,255,255,0.8);
}

/* ── STATS BAR ── */
.statsbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  display: flex;
  align-items: center;
  gap: 0;
  height: 58px;
  flex-shrink: 0;
}

.stat {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 22px;
  border-right: 1px solid var(--border);
  height: 100%;
}

.stat:first-child { padding-left: 0; }

.stat-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 1.6rem;
  font-weight: 600;
  line-height: 1;
  color: var(--text);
}

.stat-num.red { color: var(--critical); }
.stat-num.amber { color: var(--amber); }
.stat-num.green { color: var(--green); }

.stat-info { display: flex; flex-direction: column; gap: 2px; }

.stat-label {
  font-size: 0.68rem;
  font-weight: 600;
  color: var(--text-3);
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.stat-sub {
  font-size: 0.68rem;
  color: var(--text-4);
  font-family: 'IBM Plex Mono', monospace;
}

.statsbar-actions {
  margin-left: auto;
  display: flex;
  gap: 8px;
  align-items: center;
}

.btn {
  padding: 7px 16px;
  border-radius: 6px;
  font-size: 0.78rem;
  font-weight: 600;
  cursor: pointer;
  font-family: 'IBM Plex Sans', sans-serif;
  transition: all 0.15s;
  border: none;
}

.btn-primary { background: var(--blue); color: white; }
.btn-primary:hover { background: var(--blue-2); }

.btn-ghost {
  background: transparent;
  color: var(--text-2);
  border: 1px solid var(--border-2);
}

.btn-ghost:hover { background: var(--surface-3); border-color: var(--blue); color: var(--blue); }

.btn-critical { background: var(--critical); color: white; }

/* ── TOOLBAR ── */
.toolbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  height: 46px;
  flex-shrink: 0;
}

.search-wrap {
  position: relative;
  flex: 1;
  max-width: 280px;
}

.search-icon {
  position: absolute;
  left: 10px; top: 50%;
  transform: translateY(-50%);
  color: var(--text-3);
  font-size: 0.85rem;
  pointer-events: none;
}

.search-input {
  width: 100%;
  background: var(--surface-3);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 6px 10px 6px 30px;
  font-size: 0.8rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: var(--text);
  outline: none;
  transition: border-color 0.15s;
}

.search-input:focus { border-color: var(--blue); background: white; }
.search-input::placeholder { color: var(--text-4); }

.filter-group {
  display: flex;
  gap: 4px;
}

.filter-chip {
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.72rem;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid var(--border-2);
  background: transparent;
  color: var(--text-3);
  font-family: 'IBM Plex Sans', sans-serif;
  transition: all 0.12s;
  display: flex;
  align-items: center;
  gap: 5px;
}

.filter-chip:hover { border-color: var(--blue); color: var(--blue); }

.filter-chip.active-crit { background: var(--critical-bg); border-color: var(--critical-border); color: var(--critical); }
.filter-chip.active-high { background: var(--high-bg); border-color: var(--high-border); color: var(--high); }
.filter-chip.active-med  { background: var(--medium-bg); border-color: var(--medium-border); color: var(--medium); }
.filter-chip.active-low  { background: var(--low-bg); border-color: var(--low-border); color: var(--low); }
.filter-chip.active-all  { background: var(--navy); border-color: var(--navy); color: white; }

.chip-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
}

.toolbar-divider { width: 1px; height: 22px; background: var(--border); margin: 0 4px; }

.sort-select {
  background: var(--surface-3);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 5px 10px;
  font-size: 0.75rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: var(--text-2);
  outline: none;
  cursor: pointer;
}

.view-toggle {
  display: flex;
  border: 1px solid var(--border);
  border-radius: 6px;
  overflow: hidden;
}

.view-btn {
  padding: 5px 10px;
  font-size: 0.75rem;
  cursor: pointer;
  background: transparent;
  border: none;
  color: var(--text-3);
  font-family: 'IBM Plex Sans', sans-serif;
  transition: all 0.12s;
}

.view-btn.active { background: var(--navy); color: white; }

.toolbar-right { margin-left: auto; display: flex; align-items: center; gap: 8px; }

.result-count {
  font-size: 0.72rem;
  color: var(--text-3);
  font-family: 'IBM Plex Mono', monospace;
}

/* ── MAIN CONTENT ── */
.main {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* ── TIME SAVED PANEL ── */
.time-panel {
  width: 280px;
  flex-shrink: 0;
  background: var(--navy);
  border-left: 1px solid rgba(255,255,255,0.08);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  color: #e2e8f0;
}

.time-panel-header {
  padding: 14px 18px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}

.time-panel-title {
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.45);
  display: flex;
  align-items: center;
  gap: 7px;
}

.tp-live-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: #22c55e;
  animation: tppulse 2s infinite;
}

@keyframes tppulse {
  0%,100% { opacity:1; }
  50% { opacity:0.3; }
}

.time-panel-body {
  flex: 1;
  overflow-y: auto;
  padding: 0;
}

.time-panel-body::-webkit-scrollbar { width: 3px; }
.time-panel-body::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius:2px; }

/* ── BIG METRIC BLOCK ── */
.tp-metric {
  padding: 16px 18px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  position: relative;
  overflow: hidden;
}

.tp-metric::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 3px; height: 100%;
}

.tp-metric.blue::before   { background: #2075d6; }
.tp-metric.green::before  { background: #16a34a; }
.tp-metric.amber::before  { background: #d97706; }
.tp-metric.teal::before   { background: #0d9488; }
.tp-metric.purple::before { background: #7c3aed; }

.tp-label {
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.35);
  margin-bottom: 6px;
}

.tp-big {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 2rem;
  font-weight: 600;
  line-height: 1;
  margin-bottom: 4px;
}

.tp-big.blue   { color: #60a5fa; }
.tp-big.green  { color: #4ade80; }
.tp-big.amber  { color: #fbbf24; }
.tp-big.teal   { color: #2dd4bf; }
.tp-big.purple { color: #a78bfa; }

.tp-desc {
  font-size: 0.7rem;
  color: rgba(255,255,255,0.38);
  line-height: 1.4;
  margin-bottom: 10px;
}

/* ── COMPARISON BAR ── */
.tp-compare {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.tp-bar-row {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.tp-bar-label {
  display: flex;
  justify-content: space-between;
  font-size: 0.62rem;
  color: rgba(255,255,255,0.35);
}

.tp-bar-label span:last-child { font-family: 'IBM Plex Mono', monospace; font-weight: 600; }

.tp-bar-track {
  height: 6px;
  background: rgba(255,255,255,0.07);
  border-radius: 3px;
  overflow: hidden;
}

.tp-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 1.4s cubic-bezier(0.16,1,0.3,1);
}

.fill-red  { background: linear-gradient(90deg,#dc2626,#f87171); }
.fill-teal { background: linear-gradient(90deg,#0d9488,#2dd4bf); }

/* ── STEP ELIMINATION ── */
.tp-steps {
  display: flex;
  flex-direction: column;
  gap: 5px;
  margin-top: 4px;
}

.tp-step {
  display: flex;
  align-items: center;
  gap: 7px;
  font-size: 0.7rem;
  padding: 5px 8px;
  border-radius: 6px;
  border: 1px solid transparent;
}

.tp-step.cut {
  background: rgba(220,38,38,0.07);
  border-color: rgba(220,38,38,0.12);
  color: rgba(255,255,255,0.28);
  text-decoration: line-through;
  text-decoration-color: rgba(220,38,38,0.4);
}

.tp-step.kept {
  background: rgba(13,148,136,0.1);
  border-color: rgba(13,148,136,0.2);
  color: #5eead4;
}

.tp-step-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* ── SHIFT COUNTER ── */
.tp-shift {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 4px;
}

.tp-shift-item {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 7px;
  padding: 10px;
  text-align: center;
}

.tp-shift-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 1.3rem;
  font-weight: 600;
  line-height: 1;
  margin-bottom: 3px;
}

.tp-shift-lbl {
  font-size: 0.58rem;
  color: rgba(255,255,255,0.3);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  line-height: 1.3;
}

/* ── FOOTER CALLOUT ── */
.tp-callout {
  margin: 14px 18px;
  background: rgba(13,148,136,0.1);
  border: 1px solid rgba(13,148,136,0.2);
  border-radius: 8px;
  padding: 12px 14px;
}

.tp-callout-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 1.6rem;
  font-weight: 600;
  color: #2dd4bf;
  line-height: 1;
  margin-bottom: 4px;
}

.tp-callout-text {
  font-size: 0.7rem;
  color: rgba(255,255,255,0.4);
  line-height: 1.5;
}

/* ── TABLE ── */
.table-wrap {
  flex: 1;
  overflow-y: auto;
  overflow-x: auto;
}

.table-wrap::-webkit-scrollbar { width: 6px; }
.table-wrap::-webkit-scrollbar-track { background: transparent; }
.table-wrap::-webkit-scrollbar-thumb { background: var(--border-2); border-radius: 3px; }

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 900px;
}

thead {
  position: sticky;
  top: 0;
  z-index: 10;
}

thead tr {
  background: var(--surface-2);
  border-bottom: 2px solid var(--border);
}

th {
  padding: 9px 14px;
  text-align: left;
  font-size: 0.65rem;
  font-weight: 700;
  color: var(--text-3);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  white-space: nowrap;
  cursor: pointer;
  user-select: none;
  font-family: 'IBM Plex Mono', monospace;
}

th:hover { color: var(--blue); }

th.sort-asc::after { content: " ↑"; color: var(--blue); }
th.sort-desc::after { content: " ↓"; color: var(--blue); }

tbody tr {
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.1s;
}

tbody tr:hover { background: var(--blue-light); }
tbody tr.selected { background: #ddeeff; }
tbody tr.critical-row { border-left: 3px solid var(--critical); }
tbody tr.high-row { border-left: 3px solid var(--high); }
tbody tr.medium-row { border-left: 3px solid var(--medium); }
tbody tr.low-row { border-left: 3px solid var(--low-border); }

td {
  padding: 10px 14px;
  font-size: 0.8rem;
  color: var(--text);
  white-space: nowrap;
  vertical-align: middle;
}

.rank-cell {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--text-3);
  width: 40px;
}

.patient-cell { min-width: 160px; }

.patient-name {
  font-weight: 700;
  font-size: 0.85rem;
  color: var(--text);
  margin-bottom: 2px;
}

.patient-meta {
  font-size: 0.7rem;
  color: var(--text-3);
  font-family: 'IBM Plex Mono', monospace;
}

.sev-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 3px 9px;
  border-radius: 12px;
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.04em;
  white-space: nowrap;
}

.sev-critical { background: var(--critical-bg); color: var(--critical); border: 1px solid var(--critical-border); }
.sev-high     { background: var(--high-bg); color: var(--high); border: 1px solid var(--high-border); }
.sev-medium   { background: var(--medium-bg); color: var(--medium); border: 1px solid var(--medium-border); }
.sev-low      { background: var(--low-bg); color: var(--low); border: 1px solid var(--low-border); }

.score-cell {
  min-width: 110px;
}

.score-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.score-bar {
  flex: 1;
  height: 5px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
  min-width: 60px;
}

.score-fill { height: 100%; border-radius: 3px; }
.fill-critical { background: var(--critical); }
.fill-high     { background: var(--high); }
.fill-medium   { background: var(--medium); }
.fill-low      { background: var(--low); }

.score-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--text);
  min-width: 24px;
  text-align: right;
}

.vitals-cell {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.7rem;
  min-width: 130px;
}

.vital-row { display: flex; gap: 10px; }
.vital-item { display: flex; flex-direction: column; gap: 1px; }
.vital-label { font-size: 0.58rem; color: var(--text-4); text-transform: uppercase; letter-spacing: 0.06em; }
.vital-val { font-size: 0.72rem; font-weight: 600; }
.val-red { color: var(--critical); }
.val-amber { color: var(--amber); }
.val-green { color: var(--green); }
.val-normal { color: var(--text-2); }

.symptoms-cell {
  max-width: 200px;
}

.symptom-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.stag {
  background: var(--surface-3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 2px 7px;
  font-size: 0.65rem;
  color: var(--text-2);
  white-space: nowrap;
}

.stag.flag { background: var(--critical-bg); border-color: var(--critical-border); color: var(--critical); }

.wait-cell {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.78rem;
  font-weight: 600;
}

.wait-urgent { color: var(--critical); }
.wait-warn   { color: var(--amber); }
.wait-ok     { color: var(--text-2); }

.ward-cell {
  font-size: 0.72rem;
  color: var(--text-3);
  font-family: 'IBM Plex Mono', monospace;
}

.action-cell {
  display: flex;
  gap: 5px;
  align-items: center;
}

.tbl-btn {
  padding: 5px 12px;
  border-radius: 5px;
  font-size: 0.7rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  font-family: 'IBM Plex Sans', sans-serif;
  transition: all 0.12s;
  white-space: nowrap;
}

.tbl-btn-primary { background: var(--blue); color: white; }
.tbl-btn-primary:hover { background: var(--blue-2); }
.tbl-btn-critical { background: var(--critical); color: white; }
.tbl-btn-ghost { background: transparent; color: var(--text-2); border: 1px solid var(--border-2); }
.tbl-btn-ghost:hover { background: var(--surface-3); }

/* ── DETAIL PANEL ── */
.detail-panel {
  width: 320px;
  flex-shrink: 0;
  background: var(--surface);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: width 0.2s ease;
}

.detail-panel.hidden { width: 0; border: none; }

.panel-header {
  padding: 16px 18px 12px;
  border-bottom: 1px solid var(--border);
  background: var(--navy);
  color: white;
  flex-shrink: 0;
}

.panel-name {
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 3px;
}

.panel-meta {
  font-size: 0.72rem;
  color: rgba(255,255,255,0.55);
  font-family: 'IBM Plex Mono', monospace;
  margin-bottom: 10px;
}

.panel-body {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}

.panel-body::-webkit-scrollbar { width: 4px; }
.panel-body::-webkit-scrollbar-thumb { background: var(--border-2); border-radius: 2px; }

.panel-section { margin-bottom: 20px; }

.panel-section-title {
  font-size: 0.62rem;
  font-weight: 700;
  color: var(--text-3);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
  font-family: 'IBM Plex Mono', monospace;
}

.vitals-grid-panel {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.vital-card-panel {
  background: var(--surface-3);
  border: 1px solid var(--border);
  border-radius: 7px;
  padding: 10px 12px;
}

.vcl { font-size: 0.62rem; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 3px; }
.vcv { font-size: 1rem; font-weight: 700; font-family: 'IBM Plex Mono', monospace; }

.diag-tier {
  background: var(--surface-3);
  border: 1px solid var(--border);
  border-radius: 7px;
  padding: 12px;
  margin-bottom: 8px;
  border-left: 4px solid var(--border-2);
}

.diag-tier.t1 { border-left-color: var(--blue); }
.diag-tier.t2 { border-left-color: var(--high); }
.diag-tier.t3 { border-left-color: var(--border-2); }

.tier-label {
  font-size: 0.6rem;
  font-weight: 700;
  color: var(--text-3);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 3px;
  font-family: 'IBM Plex Mono', monospace;
}

.tier-name { font-size: 0.82rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }

.tier-conf { font-size: 0.7rem; color: var(--text-3); margin-bottom: 6px; }

.conf-bar { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.conf-fill { height: 100%; border-radius: 2px; }

.history-row {
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.78rem;
}

.history-row:last-child { border-bottom: none; }
.hist-cond { font-weight: 600; color: var(--text); margin-bottom: 1px; }
.hist-det { font-size: 0.68rem; color: var(--text-3); font-family: 'IBM Plex Mono', monospace; }

.alert-panel {
  background: #fff5f5;
  border: 1px solid #fca5a5;
  border-radius: 7px;
  padding: 12px;
}

.alert-title-p {
  font-size: 0.68rem;
  font-weight: 800;
  color: var(--critical);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.alert-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.alert-action {
  background: white;
  border: 1px solid #fca5a5;
  border-radius: 5px;
  padding: 4px 9px;
  font-size: 0.68rem;
  font-weight: 700;
  color: var(--critical);
}

.panel-footer {
  padding: 12px 16px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}

/* ── GROUP HEADER ── */
.group-header td {
  background: var(--surface-3);
  font-size: 0.65rem;
  font-weight: 700;
  color: var(--text-3);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  padding: 6px 14px;
  border-bottom: 1px solid var(--border);
  font-family: 'IBM Plex Mono', monospace;
}

/* ── OVERRIDE MODAL ── */
.modal-backdrop {
  position: fixed; inset: 0;
  background: rgba(11,30,53,0.55);
  z-index: 200;
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-backdrop.show { display: flex; }

.modal {
  background: white;
  border-radius: 12px;
  padding: 28px;
  width: 400px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2);
}

.modal-title { font-size: 1rem; font-weight: 700; margin-bottom: 6px; }
.modal-sub { font-size: 0.8rem; color: var(--text-3); margin-bottom: 18px; }

.modal-textarea {
  width: 100%;
  border: 1px solid var(--border-2);
  border-radius: 6px;
  padding: 10px;
  font-size: 0.82rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: var(--text);
  resize: none;
  height: 80px;
  outline: none;
  margin-bottom: 14px;
}

.modal-textarea:focus { border-color: var(--blue); }

.modal-footer { display: flex; gap: 8px; justify-content: flex-end; }

/* ── ZEBRA for dense reading ── */
tbody tr:nth-child(even):not(:hover):not(.selected) { background: rgba(240,244,248,0.5); }

/* ── TIME SAVED PANEL ── */
.time-saved-panel {
  width: 262px;
  flex-shrink: 0;
  background: var(--navy);
  border-left: 1px solid rgba(255,255,255,0.07);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.ts-header {
  padding: 13px 16px 11px;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  flex-shrink: 0;
}

.ts-title {
  font-size: 0.62rem;
  font-weight: 700;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.38);
  display: flex;
  align-items: center;
  gap: 7px;
  margin-bottom: 1px;
}

.ts-live-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: #22c55e;
  animation: tslive 2s infinite;
}

@keyframes tslive {
  0%,100% { opacity:1; } 50% { opacity:0.25; }
}

.ts-subtitle {
  font-size: 0.68rem;
  color: rgba(255,255,255,0.55);
  font-weight: 600;
}

.ts-body {
  flex: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

.ts-body::-webkit-scrollbar { width: 3px; }
.ts-body::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 2px; }

/* ── HERO METRIC ── */
.ts-hero {
  padding: 18px 16px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  text-align: center;
  background: rgba(255,255,255,0.02);
}

.ts-hero-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 3rem;
  font-weight: 600;
  color: #4ade80;
  line-height: 1;
  letter-spacing: -0.02em;
}

.ts-hero-unit {
  font-size: 0.9rem;
  color: rgba(255,255,255,0.35);
  font-weight: 400;
  margin-left: 2px;
}

.ts-hero-label {
  font-size: 0.68rem;
  color: rgba(255,255,255,0.35);
  margin-top: 4px;
  letter-spacing: 0.04em;
}

/* ── SECTION ── */
.ts-section {
  padding: 14px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

.ts-section-label {
  font-size: 0.58rem;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.28);
  margin-bottom: 10px;
}

/* ── COMPARISON BARS ── */
.ts-bar-group { display: flex; flex-direction: column; gap: 8px; }

.ts-bar-row { display: flex; flex-direction: column; gap: 3px; }

.ts-bar-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.62rem;
}

.ts-bar-name { color: rgba(255,255,255,0.35); }
.ts-bar-val  { font-family: 'IBM Plex Mono', monospace; font-weight: 600; }
.ts-bar-val.red  { color: #f87171; }
.ts-bar-val.teal { color: #2dd4bf; }

.ts-bar-track {
  height: 7px;
  background: rgba(255,255,255,0.06);
  border-radius: 4px;
  overflow: hidden;
}

.ts-bar-fill {
  height: 100%;
  border-radius: 4px;
  width: 0;
  transition: width 1.6s cubic-bezier(0.16,1,0.3,1);
}

.ts-bar-fill.before { background: linear-gradient(90deg,#dc2626,#f87171); }
.ts-bar-fill.after  { background: linear-gradient(90deg,#0d9488,#2dd4bf); }

.ts-saving-tag {
  margin-top: 4px;
  font-size: 0.62rem;
  color: #4ade80;
  font-weight: 700;
  text-align: right;
  letter-spacing: 0.04em;
}

/* ── STAT GRID ── */
.ts-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 7px;
}

.ts-grid-item {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 8px;
  padding: 10px;
}

.ts-grid-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 1.3rem;
  font-weight: 600;
  line-height: 1;
  margin-bottom: 3px;
}

.ts-grid-lbl {
  font-size: 0.58rem;
  color: rgba(255,255,255,0.28);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  line-height: 1.35;
}

/* ── STEPS ELIMINATED ── */
.ts-steps { display: flex; flex-direction: column; gap: 5px; }

.ts-step {
  display: flex;
  align-items: center;
  gap: 7px;
  font-size: 0.7rem;
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid transparent;
}

.ts-step.cut {
  background: rgba(220,38,38,0.06);
  border-color: rgba(220,38,38,0.1);
  color: rgba(255,255,255,0.22);
  text-decoration: line-through;
  text-decoration-color: rgba(220,38,38,0.35);
}

.ts-step.kept {
  background: rgba(13,148,136,0.09);
  border-color: rgba(13,148,136,0.18);
  color: #5eead4;
}

.ts-step-dot {
  width: 5px; height: 5px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* ── BOTTOM CALLOUT ── */
.ts-callout {
  margin: 12px 16px 16px;
  background: rgba(13,148,136,0.08);
  border: 1px solid rgba(13,148,136,0.18);
  border-radius: 8px;
  padding: 12px 14px;
}

.ts-callout-num {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 1.5rem;
  font-weight: 600;
  color: #2dd4bf;
  line-height: 1;
  margin-bottom: 4px;
}

.ts-callout-text {
  font-size: 0.68rem;
  color: rgba(255,255,255,0.35);
  line-height: 1.5;
}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="logo">
    <div class="logo-box">+</div>
    <div class="logo-text">SignalMD</div>
  </div>
  <div class="topbar-divider"></div>
  <div class="ward-tabs">
    <div class="ward-tab active">All Wards <span class="ward-count" id="all-count">50</span></div>
    <div class="ward-tab">Emergency <span class="ward-count">18</span></div>
    <div class="ward-tab">Cardiology <span class="ward-count">12</span></div>
    <div class="ward-tab">General <span class="ward-count">11</span></div>
    <div class="ward-tab">Neurology <span class="ward-count">9</span></div>
  </div>
  <div class="topbar-right">
    <div class="live-badge"><div class="pulse"></div> LIVE · Updated 12s ago</div>
    <div class="topbar-divider"></div>
    <div class="topbar-avatar">DR</div>
  </div>
</div>

<!-- STATS BAR -->
<div class="statsbar">
  <div class="stat">
    <div class="stat-num" id="total-stat">50</div>
    <div class="stat-info">
      <div class="stat-label">Total Patients</div>
      <div class="stat-sub">4 wards active</div>
    </div>
  </div>
  <div class="stat">
    <div class="stat-num red" id="crit-stat">8</div>
    <div class="stat-info">
      <div class="stat-label">Critical</div>
      <div class="stat-sub">Needs immediate care</div>
    </div>
  </div>
  <div class="stat">
    <div class="stat-num amber" id="high-stat">14</div>
    <div class="stat-info">
      <div class="stat-label">High Priority</div>
      <div class="stat-sub">Within 30 min</div>
    </div>
  </div>
  <div class="stat">
    <div class="stat-num green">6</div>
    <div class="stat-info">
      <div class="stat-label">Doctors On Call</div>
      <div class="stat-sub">3 available now</div>
    </div>
  </div>
  <div class="stat">
    <div class="stat-num">47m</div>
    <div class="stat-info">
      <div class="stat-label">Avg Wait Time</div>
      <div class="stat-sub">↑ 8m from baseline</div>
    </div>
  </div>
  <div class="statsbar-actions">
    <button class="btn btn-ghost">Export CSV</button>
    <button class="btn btn-primary" onclick="showIntake()">+ New Patient</button>
  </div>
</div>

<!-- TOOLBAR -->
<div class="toolbar">
  <div class="search-wrap">
    <span class="search-icon">⌕</span>
    <input class="search-input" type="text" id="search" placeholder="Search name, ID, condition..." oninput="filterTable()">
  </div>

  <div class="filter-group" id="filter-group">
    <button class="filter-chip active-all" onclick="setFilter('all', this)">
      <span class="chip-dot" style="background:#0b1e35"></span> All
    </button>
    <button class="filter-chip" onclick="setFilter('critical', this)">
      <span class="chip-dot" style="background:#c0392b"></span> Critical
    </button>
    <button class="filter-chip" onclick="setFilter('high', this)">
      <span class="chip-dot" style="background:#b45309"></span> High
    </button>
    <button class="filter-chip" onclick="setFilter('medium', this)">
      <span class="chip-dot" style="background:#047857"></span> Moderate
    </button>
    <button class="filter-chip" onclick="setFilter('low', this)">
      <span class="chip-dot" style="background:#1760b4"></span> Low
    </button>
  </div>

  <div class="toolbar-divider"></div>

  <select class="sort-select" id="sort-select" onchange="sortTable()">
    <option value="score-desc">Sort: AI Score ↓</option>
    <option value="score-asc">Sort: AI Score ↑</option>
    <option value="wait-desc">Sort: Wait Time ↓</option>
    <option value="name-asc">Sort: Name A–Z</option>
    <option value="ward">Sort: By Ward</option>
  </select>

  <div class="toolbar-divider"></div>

  <div class="view-toggle">
    <button class="view-btn active">≡ List</button>
    <button class="view-btn">⊞ Grid</button>
  </div>

  <div class="toolbar-right">
    <span class="result-count" id="result-count">Showing 50 of 50</span>
  </div>
</div>

<!-- MAIN -->
<div class="main">
  <div class="table-wrap">
    <table id="patient-table">
      <thead>
        <tr>
          <th>#</th>
          <th onclick="sortBy('name')">Patient</th>
          <th onclick="sortBy('severity')">Severity</th>
          <th onclick="sortBy('score')">AI Score</th>
          <th>Vitals</th>
          <th>Symptoms</th>
          <th onclick="sortBy('wait')">Wait</th>
          <th>Ward</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <!-- DETAIL PANEL -->
  <div class="detail-panel hidden" id="detail-panel">
    <div class="panel-header">
      <div class="panel-name" id="panel-name">—</div>
      <div class="panel-meta" id="panel-meta">—</div>
      <span class="sev-badge" id="panel-badge">—</span>
    </div>
    <div class="panel-body">
      <div class="panel-section">
        <div class="panel-section-title">Vital Signs</div>
        <div class="vitals-grid-panel" id="panel-vitals"></div>
      </div>
      <div class="panel-section">
        <div class="panel-section-title">Tiered Diagnosis</div>
        <div id="panel-diag"></div>
      </div>
      <div class="panel-section">
        <div class="panel-section-title">Medical History</div>
        <div id="panel-history"></div>
      </div>
      <div class="panel-section">
        <div class="alert-panel">
          <div class="alert-title-p">⚠ Immediate Actions</div>
          <div class="alert-actions" id="panel-actions"></div>
        </div>
      </div>
    </div>
    <div class="panel-footer">
      <button class="btn btn-ghost" style="flex:1" onclick="openOverride()">Override Rank</button>
      <button class="btn btn-critical" style="flex:1" onclick="closePanel()">Admit →</button>
    </div>
  <!-- TIME SAVED PANEL -->
  <div class="time-saved-panel">
    <div class="ts-header">
      <div class="ts-title"><div class="ts-live-dot"></div> SignalMD Impact</div>
      <div class="ts-subtitle">Time Saved Today</div>
    </div>
    <div class="ts-body">

      <!-- Hero number -->
      <div class="ts-hero">
        <div class="ts-hero-num" id="ts-counter">0<span class="ts-hero-unit">m</span></div>
        <div class="ts-hero-label">minutes saved this shift</div>
      </div>

      <!-- Triage time comparison -->
      <div class="ts-section">
        <div class="ts-section-label">Triage Time per Patient</div>
        <div class="ts-bar-group">
          <div class="ts-bar-row">
            <div class="ts-bar-labels">
              <span class="ts-bar-name">Without SignalMD</span>
              <span class="ts-bar-val red">18 min</span>
            </div>
            <div class="ts-bar-track"><div class="ts-bar-fill before" id="bar-before"></div></div>
          </div>
          <div class="ts-bar-row">
            <div class="ts-bar-labels">
              <span class="ts-bar-name">With SignalMD</span>
              <span class="ts-bar-val teal">5.8 min</span>
            </div>
            <div class="ts-bar-track"><div class="ts-bar-fill after" id="bar-after"></div></div>
          </div>
          <div class="ts-saving-tag">↓ 68% faster per patient</div>
        </div>
      </div>

      <!-- Shift stats grid -->
      <div class="ts-section">
        <div class="ts-section-label">This Shift · 12 Hours</div>
        <div class="ts-grid">
          <div class="ts-grid-item">
            <div class="ts-grid-num" style="color:#4ade80" id="ts-seen">0</div>
            <div class="ts-grid-lbl">Patients Triaged</div>
          </div>
          <div class="ts-grid-item">
            <div class="ts-grid-num" style="color:#60a5fa" id="ts-critical">0</div>
            <div class="ts-grid-lbl">Critical Fast-tracked</div>
          </div>
          <div class="ts-grid-item">
            <div class="ts-grid-num" style="color:#fbbf24" id="ts-hrs">0</div>
            <div class="ts-grid-lbl">Hours Returned</div>
          </div>
          <div class="ts-grid-item">
            <div class="ts-grid-num" style="color:#f472b6" id="ts-steps">5</div>
            <div class="ts-grid-lbl">Manual Steps Removed</div>
          </div>
        </div>
      </div>

      <!-- Steps eliminated -->
      <div class="ts-section">
        <div class="ts-section-label">Workflow Eliminated</div>
        <div class="ts-steps">
          <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Manual chart lookup</div>
          <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Paper symptom form</div>
          <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Verbal severity handoff</div>
          <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Manual queue sorting</div>
          <div class="ts-step cut"><div class="ts-step-dot" style="background:#f87171"></div>Re-entry into EHR</div>
          <div class="ts-step kept"><div class="ts-step-dot" style="background:#2dd4bf"></div>Doctor reviews &amp; confirms</div>
        </div>
      </div>

      <!-- Bottom callout -->
      <div class="ts-callout">
        <div class="ts-callout-num">3.3M</div>
        <div class="ts-callout-text">preventable readmissions annually — reduced when triage is faster and more accurate.</div>
      </div>

    </div>
  </div>
</div>
<div class="modal-backdrop" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-title">Override AI Ranking</div>
    <div class="modal-sub">Provide a clinical reason for overriding this patient's severity score. This will be logged for model improvement.</div>
    <textarea class="modal-textarea" placeholder="e.g. Patient's condition improved after initial treatment. Downgrading from Critical to High."></textarea>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="closeModal()">Submit Override</button>
    </div>
  </div>
</div>

<script>
// ── DATA GENERATION ──
const firstNames = ['Sarah','James','Priya','David','Aisha','Michael','Elena','Carlos','Mei','Robert','Jennifer','Ahmed','Sofia','Kevin','Natasha','Thomas','Yuki','Marcus','Diana','Hassan','Emma','Victor','Leila','Patrick','Zoe','Samuel','Fatima','Oliver','Grace','Andre','Hannah','Ravi','Chloe','Daniel','Nadia','Benjamin','Linh','George','Amara','Felix','Isabella','Tariq','Mia','Joseph','Ingrid','Malik','Laura','Chen','Rosa','Derek'];
const lastNames = ['Mitchell','Okafor','Nair','Chen','Kamara','Torres','Vasquez','Kim','Johnson','Patel','Williams','Hassan','Santos','Park','Ivanova','Anderson','Tanaka','Davis','Rossi','Al-Rashid','Clarke','Moreau','Ferreira','O\'Brien','Nakamura','Reyes','Dubois','Müller','Petrov','Svensson'];
const conditions = ['Chest Pain','Stroke Symptoms','Abdominal Pain','Fever/Infection','Migraine','Trauma','Cardiac Arrest','Respiratory Distress','Sepsis','Fracture','Appendicitis','Arrhythmia','Hypertensive Crisis','Diabetic Crisis','Allergic Reaction','Pneumonia','Kidney Failure','GI Bleed','Pulmonary Embolism','Head Injury'];
const wards = ['Emergency','Cardiology','General','Neurology'];
const symptoms = {
  'Chest Pain': ['Chest Pain','SOB','Left Arm Pain','Diaphoresis'],
  'Stroke Symptoms': ['Confusion','Slurred Speech','Facial Droop','Weakness'],
  'Abdominal Pain': ['Abdominal Pain','Nausea','Vomiting','Fever'],
  'Fever/Infection': ['Fever','Chills','Fatigue','Cough'],
  'Migraine': ['Headache','Photophobia','Nausea','Aura'],
  'Trauma': ['Pain','Swelling','Laceration','Bruising'],
  'Cardiac Arrest': ['Unresponsive','No Pulse','Cyanosis','Apnea'],
  'Respiratory Distress': ['SOB','Wheezing','Cyanosis','Tachycardia'],
  'Sepsis': ['Fever','Hypotension','Confusion','Tachycardia'],
  'Fracture': ['Pain','Swelling','Deformity','Bruising'],
  default: ['Fatigue','Nausea','Pain','Malaise'],
};

function rng(seed) {
  let x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

const patients = Array.from({length: 50}, (_, i) => {
  const s = i + 1;
  const name = firstNames[i] + ' ' + lastNames[i % lastNames.length];
  const age = 22 + Math.floor(rng(s*3)*60);
  const sex = rng(s*7) > 0.5 ? 'M' : 'F';
  const cond = conditions[Math.floor(rng(s*11)*conditions.length)];
  const ward = wards[Math.floor(rng(s*13)*wards.length)];
  const score = Math.max(10, Math.min(98, Math.floor(101 - (i * 1.65) - rng(s*17)*8)));
  const severity = score >= 80 ? 'critical' : score >= 60 ? 'high' : score >= 35 ? 'medium' : 'low';
  const waitMins = 5 + Math.floor(rng(s*19) * 130);
  const wait = waitMins < 60 ? `${waitMins}m` : `${Math.floor(waitMins/60)}h ${waitMins%60}m`;
  const hr = severity === 'critical' ? 105+Math.floor(rng(s*23)*30) : 65+Math.floor(rng(s*23)*40);
  const bp_sys = severity === 'critical' ? 145+Math.floor(rng(s*29)*40) : 110+Math.floor(rng(s*29)*30);
  const spo2 = severity === 'critical' ? 88+Math.floor(rng(s*31)*7) : 94+Math.floor(rng(s*31)*6);
  const pain = severity === 'critical' ? 7+Math.floor(rng(s*37)*3) : 2+Math.floor(rng(s*37)*6);
  const syms = (symptoms[cond] || symptoms.default);
  const id = `PT-24-${String(8800+i).padStart(4,'0')}`;
  const histories = [
    ['Hypertension','Lisinopril 10mg · 2019'],
    ['Type 2 Diabetes','Metformin 500mg · 2021'],
    ['Hyperlipidemia','Atorvastatin 20mg · 2020'],
    ['Atrial Fibrillation','Warfarin · 2018'],
    ['COPD','Albuterol PRN · 2017'],
  ];
  const numHist = Math.floor(rng(s*41)*3);
  const hist = histories.slice(0, numHist+1);
  const actions = ['12-lead ECG','Troponin I/T','CBC','Chest X-Ray','IV Access'].slice(0, 2+Math.floor(rng(s*43)*3));
  return { rank: i+1, name, age, sex, cond, ward, score, severity, wait, waitMins, hr, bp_sys, spo2, pain, syms, id, hist, actions };
});

let currentFilter = 'all';
let currentSort = 'score-desc';
let selectedRow = null;
let selectedPatient = null;

function severityClass(sev) {
  return {'critical':'sev-critical','high':'sev-high','medium':'sev-medium','low':'sev-low'}[sev];
}

function severityLabel(sev) {
  return {'critical':'● Critical','high':'● High','medium':'● Moderate','low':'● Low'}[sev];
}

function fillClass(sev) {
  return {'critical':'fill-critical','high':'fill-high','medium':'fill-medium','low':'fill-low'}[sev];
}

function rowClass(sev) {
  return sev+'-row';
}

function hrColor(hr) { return hr > 100 ? 'val-red' : hr < 60 ? 'val-amber' : 'val-normal'; }
function bpColor(bp) { return bp > 140 ? 'val-red' : bp > 130 ? 'val-amber' : 'val-normal'; }
function spo2Color(s) { return s < 92 ? 'val-red' : s < 95 ? 'val-amber' : 'val-green'; }
function painColor(p) { return p >= 8 ? 'val-red' : p >= 5 ? 'val-amber' : 'val-normal'; }

function waitClass(mins) {
  return mins < 20 ? 'wait-urgent' : mins < 60 ? 'wait-warn' : 'wait-ok';
}

function getFiltered() {
  const q = document.getElementById('search').value.toLowerCase();
  return patients.filter(p => {
    const matchFilter = currentFilter === 'all' || p.severity === currentFilter;
    const matchSearch = !q || p.name.toLowerCase().includes(q) || p.cond.toLowerCase().includes(q) || p.id.toLowerCase().includes(q);
    return matchFilter && matchSearch;
  });
}

function getSorted(list) {
  const s = currentSort;
  return [...list].sort((a,b) => {
    if(s === 'score-desc') return b.score - a.score;
    if(s === 'score-asc') return a.score - b.score;
    if(s === 'wait-desc') return b.waitMins - a.waitMins;
    if(s === 'name-asc') return a.name.localeCompare(b.name);
    if(s === 'ward') return a.ward.localeCompare(b.ward) || b.score - a.score;
    return 0;
  });
}

function renderTable() {
  const filtered = getFiltered();
  const sorted = getSorted(filtered);
  document.getElementById('result-count').textContent = `Showing ${sorted.length} of ${patients.length}`;

  const byWard = currentSort === 'ward';
  let html = '';
  let lastWard = null;
  let displayRank = 1;

  sorted.forEach((p, i) => {
    if(byWard && p.ward !== lastWard) {
      html += `<tr class="group-header"><td colspan="9">${p.ward} Ward</td></tr>`;
      lastWard = p.ward;
    }

    const isSelected = selectedPatient && selectedPatient.id === p.id;
    const mainSym = p.syms[0];
    const flagSym = p.severity === 'critical' || p.severity === 'high';

    html += `<tr class="${rowClass(p.severity)}${isSelected?' selected':''}" onclick="selectPatient(${p.rank-1}, this)">
      <td class="rank-cell">${displayRank++}</td>
      <td class="patient-cell">
        <div class="patient-name">${p.name}</div>
        <div class="patient-meta">${p.age}${p.sex} · ${p.id}</div>
      </td>
      <td><span class="sev-badge ${severityClass(p.severity)}">${severityLabel(p.severity)}</span></td>
      <td class="score-cell">
        <div class="score-row">
          <div class="score-bar"><div class="score-fill ${fillClass(p.severity)}" style="width:${p.score}%"></div></div>
          <span class="score-num">${p.score}</span>
        </div>
      </td>
      <td class="vitals-cell">
        <div class="vital-row">
          <div class="vital-item">
            <span class="vital-label">HR</span>
            <span class="vital-val ${hrColor(p.hr)}">${p.hr}</span>
          </div>
          <div class="vital-item">
            <span class="vital-label">BP</span>
            <span class="vital-val ${bpColor(p.bp_sys)}">${p.bp_sys}/90</span>
          </div>
          <div class="vital-item">
            <span class="vital-label">SpO₂</span>
            <span class="vital-val ${spo2Color(p.spo2)}">${p.spo2}%</span>
          </div>
          <div class="vital-item">
            <span class="vital-label">Pain</span>
            <span class="vital-val ${painColor(p.pain)}">${p.pain}/10</span>
          </div>
        </div>
      </td>
      <td class="symptoms-cell">
        <div class="symptom-tags">
          ${p.syms.slice(0,3).map((s,si) => `<span class="stag${si===0&&flagSym?' flag':''}">${s}</span>`).join('')}
          ${p.syms.length > 3 ? `<span class="stag">+${p.syms.length-3}</span>` : ''}
        </div>
      </td>
      <td class="wait-cell ${waitClass(p.waitMins)}">${p.wait}</td>
      <td class="ward-cell">${p.ward}</td>
      <td class="action-cell">
        ${p.severity === 'critical'
          ? `<button class="tbl-btn tbl-btn-critical" onclick="event.stopPropagation();selectPatient(${p.rank-1})">See Now</button>`
          : `<button class="tbl-btn tbl-btn-primary" onclick="event.stopPropagation();selectPatient(${p.rank-1})">View</button>`
        }
        <button class="tbl-btn tbl-btn-ghost" onclick="event.stopPropagation();openOverride()" title="Override rank">↕</button>
      </td>
    </tr>`;
  });

  document.getElementById('table-body').innerHTML = html;
}

function selectPatient(idx, rowEl) {
  const p = patients[idx];
  selectedPatient = p;
  renderTable();

  const panel = document.getElementById('detail-panel');
  panel.classList.remove('hidden');

  document.getElementById('panel-name').textContent = p.name;
  document.getElementById('panel-meta').textContent = `${p.age}${p.sex} · ${p.id} · ${p.ward}`;
  const badge = document.getElementById('panel-badge');
  badge.textContent = severityLabel(p.severity);
  badge.className = `sev-badge ${severityClass(p.severity)}`;

  document.getElementById('panel-vitals').innerHTML = `
    <div class="vital-card-panel"><div class="vcl">Heart Rate</div><div class="vcv ${hrColor(p.hr)}">${p.hr} <small style="font-size:0.55rem">bpm</small></div></div>
    <div class="vital-card-panel"><div class="vcl">Blood Pressure</div><div class="vcv ${bpColor(p.bp_sys)}">${p.bp_sys}/90</div></div>
    <div class="vital-card-panel"><div class="vcl">SpO₂</div><div class="vcv ${spo2Color(p.spo2)}">${p.spo2}%</div></div>
    <div class="vital-card-panel"><div class="vcl">Pain Score</div><div class="vcv ${painColor(p.pain)}">${p.pain}/10</div></div>
  `;

  const diagNames = ['Acute MI (STEMI/NSTEMI)','Unstable Angina','Pulmonary Embolism'];
  const confs = [87, 61, 24];
  const barCols = ['#1760b4','#b45309','#c8d0dc'];
  document.getElementById('panel-diag').innerHTML = ['t1','t2','t3'].map((cls,i) => `
    <div class="diag-tier ${cls}">
      <div class="tier-label">Tier ${i+1} · ${['Primary','Differential','Consider'][i]}</div>
      <div class="tier-name">${diagNames[i]}</div>
      <div class="tier-conf">Confidence: ${confs[i]}%</div>
      <div class="conf-bar"><div class="conf-fill" style="width:${confs[i]}%;background:${barCols[i]}"></div></div>
    </div>`).join('');

  document.getElementById('panel-history').innerHTML = p.hist.map(([c,d]) => `
    <div class="history-row">
      <div class="hist-cond">${c}</div>
      <div class="hist-det">${d}</div>
    </div>`).join('') || '<div style="font-size:0.78rem;color:var(--text-3)">No prior history on record.</div>';

  document.getElementById('panel-actions').innerHTML = p.actions.map(a =>
    `<div class="alert-action">${a}</div>`).join('');
}

function closePanel() {
  selectedPatient = null;
  document.getElementById('detail-panel').classList.add('hidden');
  renderTable();
}

function setFilter(f, el) {
  currentFilter = f;
  document.querySelectorAll('.filter-chip').forEach(c => {
    c.classList.remove('active-all','active-crit','active-high','active-med','active-low');
  });
  const cls = {all:'active-all',critical:'active-crit',high:'active-high',medium:'active-med',low:'active-low'};
  el.classList.add(cls[f]);
  renderTable();
}

function filterTable() { renderTable(); }

function sortTable() {
  currentSort = document.getElementById('sort-select').value;
  renderTable();
}

function sortBy(col) {
  const map = {name:'name-asc',severity:'score-desc',score:'score-desc',wait:'wait-desc'};
  currentSort = map[col] || 'score-desc';
  document.getElementById('sort-select').value = currentSort;
  renderTable();
}

function openOverride() {
  document.getElementById('modal').classList.add('show');
}

function closeModal() {
  document.getElementById('modal').classList.remove('show');
}

function showIntake() {
  alert('New patient intake would open here in the full application.');
}

// ── TIME SAVED ANIMATIONS ──
function animateCount(el, target, duration, suffix='') {
  const start = performance.now();
  const isFloat = target % 1 !== 0;
  function step(now) {
    const p = Math.min((now - start) / duration, 1);
    const ease = 1 - Math.pow(1 - p, 4);
    const val = ease * target;
    el.textContent = isFloat ? val.toFixed(1) + suffix : Math.floor(val) + suffix;
    if(p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

window.addEventListener('load', () => {
  // Animate bars after short delay
  setTimeout(() => {
    document.getElementById('bar-before').style.width = '100%';
    document.getElementById('bar-after').style.width = '32%';
  }, 400);

  // Animate counters
  setTimeout(() => {
    // minutes saved = 50 patients * 12.2 min saved each
    animateCount(document.getElementById('ts-counter'), 610, 2200);
    animateCount(document.getElementById('ts-seen'), 50, 1800);
    animateCount(document.getElementById('ts-critical'), 8, 1600);
    animateCount(document.getElementById('ts-hrs'), 10.2, 2000, 'h');
  }, 600);
});

// Init
renderTable();
</script>
</body>
</html>
